# K12 è§†é¢‘æœç´¢ç³»ç»Ÿ V3 - å®Œæ•´ SOP æ–‡æ¡£ï¼ˆå«æµç¨‹å›¾å’Œæç¤ºè¯ï¼‰

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **ç‰ˆæœ¬**: V3.1.0
- **æœ€åæ›´æ–°**: 2025-12-29
- **ä½œè€…**: AI Assistant
- **çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ“‘ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [å®Œæ•´æµç¨‹å›¾](#3-å®Œæ•´æµç¨‹å›¾)
4. [LLM æç¤ºè¯å®Œæ•´æ¸…å•](#4-llm-æç¤ºè¯å®Œæ•´æ¸…å•)
5. [æ ¸å¿ƒç»„ä»¶è¯´æ˜](#5-æ ¸å¿ƒç»„ä»¶è¯´æ˜)
6. [API æ¥å£æ–‡æ¡£](#6-api-æ¥å£æ–‡æ¡£)
7. [æ•°æ®æ¨¡å‹](#7-æ•°æ®æ¨¡å‹)
8. [ä½¿ç”¨æµç¨‹](#8-ä½¿ç”¨æµç¨‹)
9. [é”™è¯¯å¤„ç†ä¸ä¼˜åŒ–](#9-é”™è¯¯å¤„ç†ä¸ä¼˜åŒ–)
10. [éƒ¨ç½²ä¸é…ç½®](#10-éƒ¨ç½²ä¸é…ç½®)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡

K12 è§†é¢‘æœç´¢ç³»ç»Ÿ V3 æ˜¯ä¸€ä¸ª**AI é©±åŠ¨çš„å›½å®¶è‡ªåŠ¨æ¥å…¥ç³»ç»Ÿ**ï¼Œæ—¨åœ¨ä¸ºä¸åŒå›½å®¶çš„ K12 æ•™è‚²ä½“ç³»è‡ªåŠ¨æœç´¢é«˜è´¨é‡çš„æ•™è‚²è§†é¢‘èµ„æºã€‚

### 1.2 æ ¸å¿ƒç‰¹æ€§

1. **AI é©±åŠ¨çš„å›½å®¶è‡ªåŠ¨æ¥å…¥**ï¼šé€šè¿‡ UI äº¤äº’ï¼ŒAI è‡ªåŠ¨è°ƒç ”å¹¶é…ç½®æ–°å›½å®¶çš„æ•™è‚²ä½“ç³»ä¿¡æ¯
2. **æ™ºèƒ½æœç´¢è¯ç”Ÿæˆ**ï¼šæ ¹æ®å›½å®¶ã€å¹´çº§ã€å­¦ç§‘è‡ªåŠ¨ç”Ÿæˆæœ¬åœ°è¯­è¨€çš„æœç´¢è¯
3. **æ··åˆæœç´¢ç­–ç•¥**ï¼šé€šç”¨æœç´¢ï¼ˆYouTubeï¼‰+ æœ¬åœ°å®šå‘æœç´¢ï¼ˆæœ¬åœ°è§†é¢‘å¹³å°ï¼‰
4. **ç»“æœè¯„ä¼°**ï¼šä½¿ç”¨ LLM å¯¹æœç´¢ç»“æœè¿›è¡Œ 0-10 åˆ†è¯„åˆ†ï¼Œå¹¶æä¾›æ¨èç†ç”±
5. **å­¦ç§‘äº¤å‰éªŒè¯**ï¼šè‡ªåŠ¨éªŒè¯å’Œè¡¥å……é—æ¼çš„æ ¸å¿ƒå­¦ç§‘
6. **æ‰¹é‡æœç´¢**ï¼šæ”¯æŒ"å…¨éƒ¨"é€‰é¡¹ï¼Œè‡ªåŠ¨æ‰¹é‡æœç´¢æ‰€æœ‰å¹´çº§/å­¦ç§‘ç»„åˆï¼ˆå¹¶å‘æ‰§è¡Œï¼‰
7. **å†å²ç®¡ç†**ï¼šæ”¯æŒæœç´¢å†å²ç­›é€‰å’Œæ‰¹é‡å¯¼å‡º Excel

### 1.3 æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Flask 2.3+
- **æ•°æ®éªŒè¯**: Pydantic 2.0+
- **LLM API**: AI Builders API (DeepSeek, Gemini 2.5 Pro)
- **æœç´¢å¼•æ“**: Tavily Search (é€šè¿‡ AI Builders API)
- **æ•°æ®å¤„ç†**: Pandas 2.0+, OpenPyXL 3.1+
- **å¹¶å‘å¤„ç†**: ThreadPoolExecutor

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        UI[Web ç•Œé¢<br/>templates/index.html]
        UI -->|HTTP/JSON| API[Flask API<br/>web_app.py]
    end
    
    subgraph "API å±‚"
        API --> SE[æœç´¢å¼•æ“<br/>SearchEngineV2]
        API --> DA[å›½å®¶å‘ç° Agent<br/>CountryDiscoveryAgent]
        API --> CM[é…ç½®ç®¡ç†å™¨<br/>ConfigManager]
        API --> RE[ç»“æœè¯„ä¼°å™¨<br/>ResultEvaluator]
    end
    
    subgraph "æ ¸å¿ƒç»„ä»¶"
        SE --> QG[æŸ¥è¯¢ç”Ÿæˆå™¨<br/>QueryGenerator]
        SE --> TS[Tavily æœç´¢]
        SE --> EV[è§„åˆ™è¯„ä¼°å™¨<br/>ResultEvaluator]
        
        DA --> TS2[Tavily æœç´¢]
        DA --> LLM1[LLM æå–<br/>Gemini 2.5 Pro]
        DA --> LLM4[å­¦ç§‘éªŒè¯<br/>DeepSeek]
        
        RE --> LLM2[LLM è¯„ä¼°<br/>DeepSeek]
        
        QG --> LLM3[LLM ç”Ÿæˆæœç´¢è¯<br/>DeepSeek]
    end
    
    subgraph "æ•°æ®å±‚"
        CM --> CFG[countries_config.json]
        API --> HIST[search_history.json]
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡"
        TS --> AIB[AI Builders API<br/>space.ai-builders.com]
        TS2 --> AIB
        LLM1 --> AIB
        LLM2 --> AIB
        LLM3 --> AIB
        LLM4 --> AIB
    end
    
    style UI fill:#e1f5ff
    style API fill:#fff4e1
    style SE fill:#f3e5f5
    style DA fill:#e8f5e9
    style RE fill:#fce4ec
```

---

## 3. å®Œæ•´æµç¨‹å›¾

### 3.1 å›½å®¶å‘ç°æµç¨‹ï¼ˆCountry Discoveryï¼‰

```mermaid
flowchart TD
    Start([ç”¨æˆ·è¾“å…¥å›½å®¶åç§°]) --> Search1[Tavily æœç´¢: K12æ•™è‚²ä½“ç³»]
    Search1 --> Search2[Tavily æœç´¢: è¯¾ç¨‹å¤§çº²]
    Search2 --> Search3[Tavily æœç´¢: EdTechå¹³å°]
    Search3 --> Search4[Tavily æœç´¢: æœ¬åœ°è¯­è¨€å­¦ç§‘]
    
    Search4 --> Collect[æ”¶é›†æœç´¢ç»“æœ<br/>æœ€å¤š40ä¸ªç»“æœ]
    Collect --> LLM1[LLMæå–ç»“æ„åŒ–ä¿¡æ¯<br/>Gemini 2.5 Pro<br/>Prompt 1]
    
    LLM1 --> Parse1{è§£ææˆåŠŸ?}
    Parse1 -->|æ˜¯| Verify[å­¦ç§‘äº¤å‰éªŒè¯<br/>DeepSeek<br/>Prompt 2]
    Parse1 -->|å¦| Retry[å°è¯•ä¿®å¤JSON]
    Retry --> Parse1
    
    Verify --> Parse2{è§£ææˆåŠŸ?}
    Parse2 -->|æ˜¯| Merge[åˆå¹¶å­¦ç§‘åˆ—è¡¨<br/>å»é‡]
    Parse2 -->|å¦| Skip[è·³è¿‡éªŒè¯<br/>ä½¿ç”¨åŸå§‹åˆ—è¡¨]
    
    Merge --> Save[ä¿å­˜åˆ°é…ç½®<br/>countries_config.json]
    Skip --> Save
    Save --> End([è¿”å›å›½å®¶é…ç½®])
    
    style LLM1 fill:#fff4e1
    style Verify fill:#e8f5e9
    style Save fill:#e1f5ff
```

### 3.2 æœç´¢æµç¨‹ï¼ˆSearch Flowï¼‰

```mermaid
flowchart TD
    Start([ç”¨æˆ·å‘èµ·æœç´¢è¯·æ±‚]) --> Check{æ‰¹é‡æœç´¢?}
    
    Check -->|æ˜¯| Batch[æ‰¹é‡æœç´¢æ¨¡å¼]
    Check -->|å¦| Single[å•ä¸ªæœç´¢æ¨¡å¼]
    
    Single --> GenQuery[ç”Ÿæˆæœç´¢è¯<br/>DeepSeek<br/>Prompt 3]
    GenQuery --> SearchA[æœç´¢A: é€šç”¨æœç´¢<br/>Tavily API<br/>max_results=15]
    
    SearchA --> CheckConfig{å›½å®¶é…ç½®å­˜åœ¨?}
    CheckConfig -->|æ˜¯| Filter[ç­›é€‰è§†é¢‘å¹³å°åŸŸå<br/>æ’é™¤EdTechå¹³å°]
    CheckConfig -->|å¦| Merge
    
    Filter --> BuildQuery[æ„å»ºæœ¬åœ°æŸ¥è¯¢<br/>è¿½åŠ å¹³å°åç§°]
    BuildQuery --> SearchB[æœç´¢B: æœ¬åœ°å®šå‘æœç´¢<br/>Tavily API<br/>include_domains<br/>max_results=10]
    
    SearchB --> Merge[åˆå¹¶ç»“æœ<br/>åŸºäºURLå»é‡]
    Merge --> RuleEval[è§„åˆ™è¯„ä¼°<br/>ç­›é€‰é«˜è´¨é‡èµ„æº]
    
    RuleEval --> LLMEval[LLMè¯„ä¼°<br/>DeepSeek<br/>Prompt 4]
    LLMEval --> Sort[æŒ‰åˆ†æ•°æ’åº]
    Sort --> Return([è¿”å›æœç´¢ç»“æœ])
    
    Batch --> Prepare[å‡†å¤‡æœç´¢ä»»åŠ¡<br/>å¹´çº§Ã—å­¦ç§‘ç»„åˆ]
    Prepare --> ThreadPool[çº¿ç¨‹æ± å¹¶å‘æ‰§è¡Œ<br/>max_workers=4]
    ThreadPool --> GenQuery
    ThreadPool --> CollectAll[æ”¶é›†æ‰€æœ‰ç»“æœ]
    CollectAll --> Dedup[å…¨å±€å»é‡]
    Dedup --> BatchLLM[æ‰¹é‡LLMè¯„ä¼°]
    BatchLLM --> Return
    
    style GenQuery fill:#fff4e1
    style LLMEval fill:#e8f5e9
    style BatchLLM fill:#e8f5e9
```

### 3.3 ç»“æœè¯„ä¼°æµç¨‹ï¼ˆResult Evaluationï¼‰

```mermaid
flowchart TD
    Start([æ¥æ”¶æœç´¢ç»“æœåˆ—è¡¨]) --> Batch{ç»“æœæ•°é‡}
    
    Batch -->|>10| Split[åˆ†æ‰¹å¤„ç†<br/>æ¯æ‰¹10ä¸ª]
    Batch -->|â‰¤10| Single[å•æ‰¹å¤„ç†]
    
    Split --> LLM1[LLMè¯„ä¼°æ‰¹æ¬¡1<br/>DeepSeek<br/>Prompt 4]
    LLM1 --> Parse1{è§£æJSON}
    Parse1 -->|æˆåŠŸ| Update1[æ›´æ–°åˆ†æ•°å’Œç†ç”±]
    Parse1 -->|å¤±è´¥| Retry1[å°è¯•ä¿®å¤JSON]
    Retry1 --> Parse1
    
    Update1 --> LLM2[LLMè¯„ä¼°æ‰¹æ¬¡2<br/>...]
    LLM2 --> Parse2{è§£æJSON}
    Parse2 -->|æˆåŠŸ| Update2[æ›´æ–°åˆ†æ•°å’Œç†ç”±]
    Parse2 -->|å¤±è´¥| Default2[é»˜è®¤åˆ†æ•°0]
    
    Update2 --> Merge[åˆå¹¶æ‰€æœ‰æ‰¹æ¬¡]
    Single --> LLM3[LLMè¯„ä¼°<br/>DeepSeek<br/>Prompt 4]
    LLM3 --> Parse3{è§£æJSON}
    Parse3 -->|æˆåŠŸ| Update3[æ›´æ–°åˆ†æ•°å’Œç†ç”±]
    Parse3 -->|å¤±è´¥| Default3[é»˜è®¤åˆ†æ•°0]
    
    Merge --> Sort[æŒ‰åˆ†æ•°é™åºæ’åº]
    Update3 --> Sort
    Default2 --> Sort
    Default3 --> Sort
    
    Sort --> Return([è¿”å›è¯„ä¼°ç»“æœ])
    
    style LLM1 fill:#fff4e1
    style LLM2 fill:#fff4e1
    style LLM3 fill:#fff4e1
```

### 3.4 å®Œæ•´ç³»ç»Ÿæµç¨‹å›¾

```mermaid
flowchart TB
    subgraph "ç”¨æˆ·æ“ä½œ"
        U1[é€‰æ‹©å›½å®¶] --> U2{å›½å®¶å­˜åœ¨?}
        U2 -->|å¦| U3[å›½å®¶å‘ç°]
        U2 -->|æ˜¯| U4[é€‰æ‹©å¹´çº§/å­¦ç§‘]
        U3 --> U4
        U4 --> U5[å‘èµ·æœç´¢]
    end
    
    subgraph "å›½å®¶å‘ç°æµç¨‹"
        U3 --> D1[æœç´¢æ•™è‚²ä½“ç³»ä¿¡æ¯]
        D1 --> D2[LLMæå–ä¿¡æ¯<br/>Prompt 1]
        D2 --> D3[å­¦ç§‘äº¤å‰éªŒè¯<br/>Prompt 2]
        D3 --> D4[ä¿å­˜é…ç½®]
    end
    
    subgraph "æœç´¢æµç¨‹"
        U5 --> S1[ç”Ÿæˆæœç´¢è¯<br/>Prompt 3]
        S1 --> S2[é€šç”¨æœç´¢]
        S2 --> S3[æœ¬åœ°å®šå‘æœç´¢]
        S3 --> S4[åˆå¹¶å»é‡]
        S4 --> S5[è§„åˆ™è¯„ä¼°]
        S5 --> S6[LLMè¯„ä¼°<br/>Prompt 4]
        S6 --> S7[è¿”å›ç»“æœ]
    end
    
    subgraph "ç»“æœå¤„ç†"
        S7 --> R1[æ˜¾ç¤ºç»“æœ]
        R1 --> R2{ç”¨æˆ·æ“ä½œ}
        R2 -->|å¯¼å‡º| R3[å¯¼å‡ºExcel]
        R2 -->|æŸ¥çœ‹å†å²| R4[æŸ¥çœ‹å†å²è®°å½•]
    end
    
    style D2 fill:#fff4e1
    style D3 fill:#e8f5e9
    style S1 fill:#fff4e1
    style S6 fill:#e8f5e9
```

---

## 4. LLM æç¤ºè¯å®Œæ•´æ¸…å•

### 4.1 æç¤ºè¯æ€»è§ˆè¡¨

| åºå· | æç¤ºè¯åç§° | ä½¿ç”¨åœºæ™¯ | LLM æ¨¡å‹ | Temperature | Max Tokens | è¿”å›æ ¼å¼ | ç¦ç”¨å·¥å…· |
|------|-----------|---------|----------|-------------|------------|----------|---------|
| 1 | å›½å®¶ä¿¡æ¯æå– | ä»æœç´¢ç»“æœæå–å›½å®¶æ•™è‚²ä½“ç³»ä¿¡æ¯ | Gemini 2.5 Pro | 0.2 | 4000 | JSON å¯¹è±¡ | âŒ |
| 2 | å­¦ç§‘äº¤å‰éªŒè¯ | éªŒè¯å’Œè¡¥å……é—æ¼çš„æ ¸å¿ƒå­¦ç§‘ | DeepSeek | 0.2 | 1000 | JSON æ•°ç»„ | âœ… |
| 3 | æœç´¢è¯ç”Ÿæˆ | æ ¹æ®å›½å®¶/å¹´çº§/å­¦ç§‘ç”Ÿæˆæœç´¢è¯ | DeepSeek | 0.3 | 100 | çº¯æ–‡æœ¬ | âœ… |
| 4 | ç»“æœè¯„ä¼° | å¯¹æœç´¢ç»“æœè¯„åˆ†å’Œæ¨è | DeepSeek | 0.3 | 2000 | JSON æ•°ç»„ | âœ… |

---

### 4.2 æç¤ºè¯ 1: å›½å®¶ä¿¡æ¯æå–ï¼ˆCountry Profile Extractionï¼‰

**æ–‡ä»¶ä½ç½®**: `discovery_agent.py` (ç¬¬ 114-191 è¡Œ)

**ç”¨é€”**: ä» Tavily æœç´¢ç»“æœä¸­æå–å›½å®¶ K12 æ•™è‚²ä½“ç³»çš„ç»“æ„åŒ–ä¿¡æ¯

**æ¨¡å‹**: Gemini 2.5 Pro

**å‚æ•°é…ç½®**:
- `temperature`: 0.2
- `max_tokens`: 4000
- `tool_choice`: é»˜è®¤ï¼ˆå…è®¸å·¥å…·è°ƒç”¨ï¼‰

**è°ƒç”¨æ–¹æ³•**: `client.call_gemini()`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªæ•™è‚²ä½“ç³»åˆ†æä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯åˆ†ææœç´¢ç»“æœï¼Œæå–æŒ‡å®šå›½å®¶çš„ K12 æ•™è‚²ä½“ç³»ä¿¡æ¯ã€‚

**å…³é”®è¦æ±‚**ï¼š
1. **å¹´çº§è¡¨è¾¾å¿…é¡»ä½¿ç”¨å½“åœ°è¯­è¨€**ï¼šä¾‹å¦‚å°å°¼æ˜¯ "Kelas 1-12"ï¼Œè²å¾‹å®¾æ˜¯ "Kindergarten, Grade 1-12"ï¼Œæ—¥æœ¬æ˜¯ "å°å­¦1å¹´ç”Ÿ-6å¹´ç”Ÿ, ä¸­å­¦1å¹´ç”Ÿ-3å¹´ç”Ÿ"
2. **å­¦ç§‘åç§°å¿…é¡»ä½¿ç”¨å½“åœ°è¯­è¨€**ï¼šä¾‹å¦‚å°å°¼æ˜¯ "Matematika, IPA, IPS"ï¼Œè²å¾‹å®¾æ˜¯ "Math, Science, Filipino, Araling Panlipunan"ï¼Œæ—¥æœ¬æ˜¯ "å›½èª, ç®—æ•°, ç†ç§‘, ç¤¾ä¼š"
3. **è¯­è¨€ä»£ç **ï¼šä½¿ç”¨ ISO 639-1 æ ‡å‡†ï¼ˆå¦‚ï¼šid, en, ja, fil, msï¼‰
4. **å›½å®¶ä»£ç **ï¼šä½¿ç”¨ ISO 3166-1 alpha-2 æ ‡å‡†ï¼ˆå¦‚ï¼šID, PH, JP, MY, SGï¼‰

è¯·ä»”ç»†åˆ†ææœç´¢ç»“æœï¼Œæå–å‡†ç¡®çš„ä¿¡æ¯ã€‚
```

#### User Prompt

```
è¯·åˆ†æä»¥ä¸‹å…³äº {country_name} çš„ K12 æ•™è‚²ä½“ç³»æœç´¢ç»“æœï¼Œæå–ä»¥ä¸‹ä¿¡æ¯ï¼š

**éœ€è¦æå–çš„ä¿¡æ¯**ï¼š
1. **å›½å®¶ä»£ç **ï¼ˆISO 3166-1 alpha-2ï¼Œå¦‚ï¼šID, PH, JPï¼‰
2. **å›½å®¶åç§°**ï¼ˆè‹±æ–‡æ ‡å‡†åç§°ï¼‰
3. **å›½å®¶ä¸­æ–‡åç§°**ï¼ˆä¸­æ–‡æ ‡å‡†åç§°ï¼Œå¦‚ï¼šè²å¾‹å®¾ã€æ—¥æœ¬ã€å°å°¼ï¼‰
4. **ä¸»è¦è¯­è¨€ä»£ç **ï¼ˆISO 639-1ï¼Œå¦‚ï¼šid, en, jaï¼‰
5. **å¹´çº§è¡¨è¾¾åˆ—è¡¨**ï¼ˆæ¯ä¸ªå¹´çº§åŒ…å«å½“åœ°è¯­è¨€åç§°å’Œä¸­æ–‡åç§°ï¼‰
6. **æ ¸å¿ƒå­¦ç§‘åˆ—è¡¨**ï¼ˆæ¯ä¸ªå­¦ç§‘åŒ…å«å½“åœ°è¯­è¨€åç§°å’Œä¸­æ–‡åç§°ï¼‰
7. **EdTech åŸŸåç™½åå•**ï¼ˆè¯¥å›½çš„åœ¨çº¿æ•™è‚²å¹³å°åŸŸåï¼ŒåŒ…æ‹¬ä¸¤ç±»ï¼‰ï¼š
   a. **EdTech å¹³å°**ï¼šå¦‚ Khan Academy, Ruangguru, Zenius, Coursera ç­‰åœ¨çº¿æ•™è‚²å¹³å°
   b. **æœ¬åœ°è§†é¢‘æ‰˜ç®¡å¹³å°**ï¼šå¦‚ Rutubeï¼ˆä¿„ç½—æ–¯ï¼‰, Bilibiliï¼ˆä¸­å›½ï¼‰, Vidioï¼ˆå°å°¼ï¼‰, Dailymotionï¼ˆæ³•å›½ï¼‰ç­‰æœ¬åœ°è§†é¢‘å¹³å°
8. **é¢å¤–è¯´æ˜**ï¼ˆå¦‚æœ‰ï¼‰

**æœç´¢ç»“æœ**ï¼š
{search_context}

**é‡è¦**ï¼š
- å¹´çº§å’Œå­¦ç§‘åç§°å¿…é¡»ä½¿ç”¨**å½“åœ°è¯­è¨€**ï¼ŒåŒæ—¶æä¾›å¯¹åº”çš„ä¸­æ–‡ç¿»è¯‘
- å¦‚æœæœç´¢ç»“æœä¸­æ²¡æœ‰æ˜ç¡®ä¿¡æ¯ï¼Œè¯·åŸºäºè¯¥å›½çš„æ•™è‚²ä½“ç³»å¸¸è¯†è¿›è¡Œåˆç†æ¨æ–­
- å¹´çº§åˆ—è¡¨åº”è¯¥è¦†ç›– K12 çš„æ‰€æœ‰å¹´çº§ï¼ˆé€šå¸¸æ˜¯ 12-13 ä¸ªå¹´çº§ï¼‰
- å­¦ç§‘åˆ—è¡¨åº”è¯¥åŒ…å«è¯¥å›½çš„æ ¸å¿ƒå­¦ç§‘ï¼ˆè‡³å°‘ 5-8 ä¸ªï¼‰
- **åŸŸåæå–**ï¼šå¿…é¡»åŒæ—¶æå– EdTech å¹³å°å’Œæœ¬åœ°è§†é¢‘æ‰˜ç®¡å¹³å°ä¸¤ç±»åŸŸåï¼Œç¡®ä¿è¦†ç›–è¯¥å›½çš„ä¸»è¦åœ¨çº¿æ•™è‚²èµ„æºå¹³å°

**é‡è¦**ï¼šè¯·åªè¿”å›æœ‰æ•ˆçš„ JSON å¯¹è±¡ï¼Œä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡æœ¬ã€è§£é‡Šæˆ– markdown æ ‡è®°ã€‚ç›´æ¥è¿”å› JSONï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

{
    "country_code": "PH",
    "country_name": "Philippines",
    "country_name_zh": "è²å¾‹å®¾",
    "language_code": "en",
    "grades": [
        {"local_name": "Kindergarten", "zh_name": "å¹¼å„¿å›­"},
        {"local_name": "Grade 1", "zh_name": "ä¸€å¹´çº§"},
        {"local_name": "Grade 2", "zh_name": "äºŒå¹´çº§"},
        ...
    ],
    "subjects": [
        {"local_name": "Math", "zh_name": "æ•°å­¦"},
        {"local_name": "Science", "zh_name": "ç§‘å­¦"},
        ...
    ],
    "domains": [
        "deped.gov.ph",
        "khanacademy.org",
        "rutube.ru",
        "bilibili.com"
    ],
    "notes": "è²å¾‹å®¾ä½¿ç”¨è‹±è¯­å’Œè²å¾‹å®¾è¯­åŒè¯­æ•™å­¦"
}

**æ³¨æ„**ï¼š
- language_code å¿…é¡»æ˜¯å•ä¸ªå­—ç¬¦ä¸²ï¼ˆå¦‚ "en"ï¼‰ï¼Œä¸æ˜¯æ•°ç»„
- grades å’Œ subjects å¿…é¡»æ˜¯å¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å« local_name å’Œ zh_name
- ç›´æ¥è¿”å› JSONï¼Œä¸è¦æ·»åŠ ä»»ä½•å‰ç¼€æˆ–åç¼€
```

**å‚æ•°è¯´æ˜**:
- `{country_name}`: å›½å®¶åç§°ï¼ˆè‹±æ–‡ï¼Œå¦‚ "Philippines", "Japan"ï¼‰
- `{search_context}`: æœç´¢ç»“æœä¸Šä¸‹æ–‡ï¼ˆå‰20ä¸ªç»“æœçš„æ ‡é¢˜ã€URLã€æ‘˜è¦ï¼‰

**è¿”å›æ ¼å¼**:
```json
{
    "country_code": "PH",
    "country_name": "Philippines",
    "country_name_zh": "è²å¾‹å®¾",
    "language_code": "en",
    "grades": [
        {"local_name": "Kindergarten", "zh_name": "å¹¼å„¿å›­"},
        ...
    ],
    "subjects": [
        {"local_name": "Math", "zh_name": "æ•°å­¦"},
        ...
    ],
    "domains": ["deped.gov.ph", "khanacademy.org"],
    "notes": "..."
}
```

---

### 4.3 æç¤ºè¯ 2: å­¦ç§‘äº¤å‰éªŒè¯ï¼ˆSubject Cross-Verificationï¼‰

**æ–‡ä»¶ä½ç½®**: `discovery_agent.py` (ç¬¬ 263-306 è¡Œ)

**ç”¨é€”**: å®¡æŸ¥å·²æå–çš„å­¦ç§‘åˆ—è¡¨ï¼Œæ‰¾å‡ºé—æ¼çš„æ ¸å¿ƒå­¦ç§‘

**æ¨¡å‹**: DeepSeek

**å‚æ•°é…ç½®**:
- `temperature`: 0.2
- `max_tokens`: 1000
- `tool_choice`: "none"
- `tools`: None

**è°ƒç”¨æ–¹æ³•**: `client.call_llm(model="deepseek")`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ª{country_name}çš„ K12 æ•™è‚²ä½“ç³»ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å®¡æŸ¥å·²æå–çš„å­¦ç§‘åˆ—è¡¨ï¼Œå¯¹æ¯”è¯¥å›½å®˜æ–¹ K12 è¯¾ç¨‹å¤§çº²ï¼Œæ‰¾å‡ºè¢«é—æ¼çš„æ ¸å¿ƒå­¦ç§‘ï¼ˆCore Subjectsï¼‰ã€‚

**é‡è¦åŸåˆ™**ï¼š
1. åªè¯†åˆ«**æ ¸å¿ƒå­¦ç§‘**ï¼ˆCore Subjectsï¼‰ï¼Œè¿™äº›å­¦ç§‘é€šå¸¸æ˜¯ï¼š
   - è¯­è¨€ç±»ï¼šæ¯è¯­ã€å¤–è¯­ã€åœ°æ–¹è¯­è¨€
   - æ•°å­¦ç±»ï¼šæ•°å­¦ã€ç®—æœ¯
   - ç§‘å­¦ç±»ï¼šè‡ªç„¶ç§‘å­¦ã€ç‰©ç†ã€åŒ–å­¦ã€ç”Ÿç‰©
   - ç¤¾ä¼šç±»ï¼šå†å²ã€åœ°ç†ã€ç¤¾ä¼šç ”ç©¶ã€å…¬æ°‘æ•™è‚²
   - è‰ºæœ¯ç±»ï¼šéŸ³ä¹ã€ç¾æœ¯ã€è‰ºæœ¯
   - ä½“è‚²ç±»ï¼šä½“è‚²ã€å¥åº·
   - æŠ€æœ¯ç±»ï¼šä¿¡æ¯æŠ€æœ¯ã€æŠ€æœ¯æ•™è‚²
   - ä»·å€¼è§‚ç±»ï¼šé“å¾·æ•™è‚²ã€å®—æ•™æ•™è‚²

2. **ä¸è¦**åŒ…æ‹¬é€‰ä¿®è¯¾ã€å…´è¶£ç­ã€è¯¾å¤–æ´»åŠ¨ç­‰éæ ¸å¿ƒå­¦ç§‘

3. å¦‚æœå½“å‰åˆ—è¡¨å·²ç»å®Œæ•´ï¼Œè¿”å›ç©ºæ•°ç»„

4. æ¯ä¸ªé—æ¼çš„å­¦ç§‘å¿…é¡»åŒ…å«ï¼š
   - local_nameï¼šä½¿ç”¨è¯¥å›½å½“åœ°è¯­è¨€çš„å­¦ç§‘åç§°
   - zh_nameï¼šå¯¹åº”çš„ä¸­æ–‡åç§°

5. åªè¿”å› JSON æ•°ç»„ï¼Œä¸è¦å…¶ä»–æ–‡å­—
```

#### User Prompt

```
è¯·å®¡æŸ¥ä»¥ä¸‹å…³äº {country_name} çš„ K12 æ•™è‚²ä½“ç³»å·²æå–çš„å­¦ç§‘åˆ—è¡¨ï¼š

**å½“å‰å­¦ç§‘åˆ—è¡¨**ï¼š
{current_subjects_list}

**ä»»åŠ¡**ï¼š
å¯¹æ¯” {country_name} çš„å®˜æ–¹ K12 è¯¾ç¨‹å¤§çº²ï¼Œæ‰¾å‡ºè¢«é—æ¼çš„æ ¸å¿ƒå­¦ç§‘ã€‚

**è¦æ±‚**ï¼š
1. åªè¯†åˆ«æ ¸å¿ƒå­¦ç§‘ï¼ˆCore Subjectsï¼‰ï¼Œä¸åŒ…æ‹¬é€‰ä¿®è¯¾
2. å¦‚æœåˆ—è¡¨å·²ç»å®Œæ•´ï¼Œè¿”å›ç©ºæ•°ç»„ []
3. æ¯ä¸ªé—æ¼çš„å­¦ç§‘å¿…é¡»ä½¿ç”¨å½“åœ°è¯­è¨€åç§°ï¼Œå¹¶æä¾›ä¸­æ–‡ç¿»è¯‘
4. åªè¿”å› JSON æ•°ç»„æ ¼å¼ï¼Œä¸è¦å…¶ä»–æ–‡å­—

**è¿”å›æ ¼å¼**ï¼ˆJSON æ•°ç»„ï¼‰ï¼š
[
    {"local_name": "å­¦ç§‘å½“åœ°è¯­è¨€åç§°", "zh_name": "å­¦ç§‘ä¸­æ–‡åç§°"},
    {"local_name": "å¦ä¸€ä¸ªå­¦ç§‘", "zh_name": "å¦ä¸€ä¸ªå­¦ç§‘ä¸­æ–‡"}
]

å¦‚æœåˆ—è¡¨å®Œæ•´ï¼Œè¿”å›ï¼š[]
```

**å‚æ•°è¯´æ˜**:
- `{country_name}`: å›½å®¶åç§°ï¼ˆè‹±æ–‡ï¼‰
- `{current_subjects_list}`: å½“å‰å­¦ç§‘åˆ—è¡¨ï¼ˆæ ¼å¼ï¼š`"å­¦ç§‘å (ä¸­æ–‡å)"`ï¼‰

**è¿”å›æ ¼å¼**:
```json
[
    {"local_name": "Pendidikan Agama", "zh_name": "å®—æ•™æ•™è‚²"},
    {"local_name": "Seni Budaya", "zh_name": "è‰ºæœ¯"}
]
```

**å¦‚æœåˆ—è¡¨å®Œæ•´ï¼Œè¿”å›**:
```json
[]
```

---

### 4.4 æç¤ºè¯ 3: æœç´¢è¯ç”Ÿæˆï¼ˆQuery Generationï¼‰

**æ–‡ä»¶ä½ç½®**: `search_engine_v2.py` (ç¬¬ 279-299 è¡Œ)

**ç”¨é€”**: æ ¹æ®å›½å®¶ã€å¹´çº§ã€å­¦æœŸã€å­¦ç§‘ç”Ÿæˆæœ¬åœ°è¯­è¨€çš„æœç´¢è¯

**æ¨¡å‹**: DeepSeekï¼ˆé»˜è®¤ï¼‰ï¼Œé™çº§ï¼šGemini 2.5 Pro

**å‚æ•°é…ç½®**:
- `temperature`: 0.3
- `max_tokens`: 100
- `tool_choice`: "none"
- `tools`: None

**è°ƒç”¨æ–¹æ³•**: `client.call_llm(model="deepseek")`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æœç´¢è¯ç”Ÿæˆä¸“å®¶ï¼Œä¸“é—¨ä¸ºæ•™è‚²è§†é¢‘èµ„æºç”Ÿæˆé«˜è´¨é‡çš„æœç´¢è¯ã€‚
ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®å›½å®¶ã€å¹´çº§ã€å­¦æœŸã€å­¦ç§‘ä¿¡æ¯ï¼Œç”Ÿæˆä½¿ç”¨{language}è¯­è¨€çš„æœç´¢è¯ã€‚

é‡è¦åŸåˆ™ï¼š
1. ä½¿ç”¨ç›®æ ‡å›½å®¶çš„å®˜æ–¹è¯­è¨€æˆ–å¸¸ç”¨è¯­è¨€
2. ä½¿ç”¨è¯¥å›½å®¶æ•™è‚²ç³»ç»Ÿä¸­å¸¸ç”¨çš„æœ¯è¯­
3. ä¼˜å…ˆä½¿ç”¨"playlist"ã€"è¯¾ç¨‹"ã€"æ•™å­¦è§†é¢‘"ç­‰å…³é”®è¯
4. æœç´¢è¯åº”è¯¥ç®€æ´ã€å‡†ç¡®ã€æœ‰æ•ˆ
5. åªè¿”å›æœç´¢è¯ï¼Œä¸è¦å…¶ä»–è§£é‡Š
```

#### User Prompt

```
è¯·ä¸ºä»¥ä¸‹æ•™è‚²è§†é¢‘æœç´¢ç”Ÿæˆæœç´¢è¯ï¼š

å›½å®¶ï¼š{country}
å¹´çº§ï¼š{grade}
å­¦æœŸï¼š{semester or "ä¸æŒ‡å®š"}
å­¦ç§‘ï¼š{subject}
è¯­è¨€ï¼š{language}

è¯·ç”Ÿæˆä¸€ä¸ªç®€æ´æœ‰æ•ˆçš„æœç´¢è¯ï¼Œä½¿ç”¨{language}è¯­è¨€ï¼Œä¼˜å…ˆåŒ…å«"playlist"æˆ–"è¯¾ç¨‹"ç­‰å…³é”®è¯ã€‚

åªè¿”å›æœç´¢è¯ï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚
```

**å‚æ•°è¯´æ˜**:
- `{language}`: æ ¹æ®å›½å®¶è‡ªåŠ¨æ˜ å°„
  - ID â†’ id (å°å°¼è¯­)
  - CN â†’ zh (ä¸­æ–‡)
  - US â†’ en (è‹±è¯­)
  - MY â†’ ms (é©¬æ¥è¯­)
  - SG â†’ en (æ–°åŠ å¡è‹±è¯­)
- `{country}`: å›½å®¶ä»£ç ï¼ˆå¦‚ï¼šID, CN, USï¼‰
- `{grade}`: å¹´çº§ï¼ˆå¦‚ï¼šKelas 1, Grade 1, ä¸€å¹´çº§ï¼‰
- `{semester}`: å­¦æœŸï¼ˆå¦‚ï¼š1, Semester 1ï¼‰æˆ–"ä¸æŒ‡å®š"
- `{subject}`: å­¦ç§‘ï¼ˆå¦‚ï¼šMatematika, Mathematics, æ•°å­¦ï¼‰

**è¿”å›æ ¼å¼**: çº¯æ–‡æœ¬æœç´¢è¯

**ç¤ºä¾‹è¾“å…¥**:
- å›½å®¶ï¼šID
- å¹´çº§ï¼šKelas 3
- å­¦æœŸï¼šä¸æŒ‡å®š
- å­¦ç§‘ï¼šMatematika
- è¯­è¨€ï¼šid

**ç¤ºä¾‹è¾“å‡º**:
```
playlist matematika kelas 3 SD kurikulum merdeka
```

---

### 4.5 æç¤ºè¯ 4: ç»“æœè¯„ä¼°ï¼ˆResult Evaluationï¼‰

**æ–‡ä»¶ä½ç½®**: `result_evaluator.py` (ç¬¬ 94-152 è¡Œ)

**ç”¨é€”**: å¯¹æœç´¢ç»“æœè¿›è¡Œè¯„åˆ†ï¼ˆ0-10åˆ†ï¼‰å’Œæ¨è

**æ¨¡å‹**: DeepSeek

**å‚æ•°é…ç½®**:
- `temperature`: 0.3
- `max_tokens`: 2000
- `tool_choice`: "none"
- `tools`: None

**è°ƒç”¨æ–¹æ³•**: `client.call_llm(model="deepseek")`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªæ•™è‚²å†…å®¹è´¨é‡è¯„ä¼°ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å¯¹æœç´¢ç»“æœè¿›è¡Œè¯„åˆ†å’Œæ¨èã€‚

**é‡è¦è¯´æ˜**ï¼š
ä½ åªèƒ½æ ¹æ®æä¾›çš„æ ‡é¢˜ã€URL å’Œæ‘˜è¦ï¼ˆSnippetï¼‰ä¿¡æ¯è¿›è¡Œè¯„ä¼°ã€‚è¿™äº›ä¿¡æ¯é€šå¸¸ä¸åŒ…å«æ’­æ”¾æ¬¡æ•°ã€å…·ä½“å‘å¸ƒæ—¥æœŸç­‰å…ƒæ•°æ®ï¼Œè¯·åŸºäºå¯è§ä¿¡æ¯è¿›è¡Œåˆç†åˆ¤æ–­ã€‚

**è¯„åˆ†æ ‡å‡†ï¼ˆ0-10åˆ†ï¼‰**ï¼š
1. **å†…å®¹ç›¸å…³æ€§**ï¼ˆ0-4åˆ†ï¼‰ï¼šå†…å®¹æ˜¯å¦ä¸æŒ‡å®šçš„å›½å®¶ã€å¹´çº§ã€å­¦ç§‘åŒ¹é…
   - æ ‡é¢˜å’Œæ‘˜è¦ä¸­æ˜¯å¦åŒ…å«ç›¸å…³å…³é”®è¯
   - æ˜¯å¦æ˜ç¡®é’ˆå¯¹ç›®æ ‡å¹´çº§å’Œå­¦ç§‘
   - URL è·¯å¾„æ˜¯å¦æš—ç¤ºæ•™è‚²å†…å®¹

2. **æ¥æºæƒå¨æ€§**ï¼ˆ0-3åˆ†ï¼‰ï¼šå†…å®¹æ¥æºæ˜¯å¦å¯é 
   - æ˜¯å¦æ¥è‡ªçŸ¥åæ•™è‚²å¹³å°ï¼ˆå¦‚ Khan Academyã€Ruangguruã€Zenius ç­‰ï¼‰
   - æ˜¯å¦æ¥è‡ªå®˜æ–¹æ•™è‚²é¢‘é“æˆ–æœºæ„
   - URL åŸŸåæ˜¯å¦å¯ä¿¡

3. **æ ‡é¢˜åŒ¹é…åº¦**ï¼ˆ0-3åˆ†ï¼‰ï¼šæ ‡é¢˜æ˜¯å¦æ¸…æ™°ã€ä¸“ä¸šã€ç¬¦åˆæ•™è‚²å†…å®¹ç‰¹å¾
   - æ ‡é¢˜æ˜¯å¦æ˜ç¡®è¯´æ˜æ˜¯è¯¾ç¨‹ã€æ’­æ”¾åˆ—è¡¨æˆ–ç³»åˆ—å†…å®¹
   - æ˜¯å¦åŒ…å«å¹´çº§ã€å­¦ç§‘ç­‰å…³é”®ä¿¡æ¯
   - æ ‡é¢˜æ˜¯å¦ä¸“ä¸šã€è§„èŒƒ

**è¯„åˆ†è§„åˆ™**ï¼š
- 9-10åˆ†ï¼šéå¸¸ä¼˜ç§€ï¼Œå¼ºçƒˆæ¨èï¼ˆé«˜åº¦ç›¸å…³ + æƒå¨æ¥æº + æ¸…æ™°æ ‡é¢˜ï¼‰
- 7-8åˆ†ï¼šè‰¯å¥½ï¼Œæ¨èä½¿ç”¨ï¼ˆç›¸å…³ + æ¥æºå¯é  + æ ‡é¢˜æ¸…æ™°ï¼‰
- 5-6åˆ†ï¼šä¸€èˆ¬ï¼Œå¯ä»¥ä½¿ç”¨ï¼ˆåŸºæœ¬ç›¸å…³ï¼Œä½†å¯èƒ½ç¼ºå°‘æŸäº›è¦ç´ ï¼‰
- 3-4åˆ†ï¼šè¾ƒå·®ï¼Œä¸æ¨èï¼ˆç›¸å…³æ€§ä½æˆ–æ¥æºä¸å¯é ï¼‰
- 0-2åˆ†ï¼šå¾ˆå·®ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼ˆå®Œå…¨ä¸ç›¸å…³æˆ–æ¥æºå¯ç–‘ï¼‰

**é‡è¦**ï¼šåœ¨æ¨èç†ç”±ä¸­ï¼Œè¯·æ˜ç¡®æŒ‡å‡ºä½ æ˜¯åŸºäºæä¾›çš„æ‘˜è¦ï¼ˆSnippetï¼‰ä¿¡æ¯è¿›è¡Œè¯„ä¼°çš„ï¼Œä¸è¦ç¼–é€ ä¸å­˜åœ¨çš„æ’­æ”¾æ¬¡æ•°æˆ–æ—¥æœŸä¿¡æ¯ã€‚
```

#### User Prompt

```
è¯·è¯„ä¼°ä»¥ä¸‹æœç´¢ç»“æœï¼Œè¿™äº›ç»“æœæ˜¯ä¸º **{country}** çš„ **{grade}** å¹´çº§ **{subject}** å­¦ç§‘æœç´¢çš„ã€‚

**æœç´¢ç»“æœ**ï¼š
{results_context}

**è¯„ä¼°è¦æ±‚**ï¼š
1. ä¸ºæ¯ä¸ªç»“æœè¯„åˆ†ï¼ˆ0-10åˆ†ï¼‰ï¼ŒåŸºäºå†…å®¹ç›¸å…³æ€§ã€æ¥æºæƒå¨æ€§å’Œæ ‡é¢˜åŒ¹é…åº¦
2. æä¾›ç®€çŸ­çš„æ¨èç†ç”±ï¼ˆ1-2å¥è¯ï¼‰ï¼Œæ˜ç¡®æŒ‡å‡ºæ˜¯åŸºäºæ‘˜è¦ä¿¡æ¯è¯„ä¼°çš„
3. **é‡è¦**ï¼šä¸è¦ç¼–é€ æ’­æ”¾æ¬¡æ•°ã€å‘å¸ƒæ—¥æœŸç­‰ä¸å­˜åœ¨çš„å…ƒæ•°æ®ä¿¡æ¯
4. å¦‚æœæ‘˜è¦ä¿¡æ¯ä¸è¶³ï¼Œè¯·åŸºäºæ ‡é¢˜å’Œ URL è¿›è¡Œåˆç†æ¨æ–­

è¯·ä»¥ JSON æ•°ç»„æ ¼å¼è¿”å›ç»“æœï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
[
    {
        "index": 1,
        "score": 8.5,
        "recommendation_reason": "åŸºäºæ‘˜è¦åˆ¤æ–­ï¼šå†…å®¹é«˜åº¦ç›¸å…³ï¼Œæ¥è‡ªçŸ¥åæ•™è‚²å¹³å°ï¼Œæ ‡é¢˜æ¸…æ™°æ˜ç¡®"
    },
    {
        "index": 2,
        "score": 6.0,
        "recommendation_reason": "åŸºäºæ‘˜è¦åˆ¤æ–­ï¼šåŸºæœ¬ç›¸å…³ï¼Œä½†æ¥æºä¿¡æ¯ä¸è¶³"
    }
]

**é‡è¦**ï¼š
- åªè¿”å› JSON æ•°ç»„ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡æœ¬
- æ¨èç†ç”±ä¸­å¿…é¡»åŒ…å«"åŸºäºæ‘˜è¦åˆ¤æ–­"æˆ–ç±»ä¼¼è¯´æ˜
- ä¸è¦ä½¿ç”¨å·¥å…·è°ƒç”¨ï¼Œç›´æ¥è¿”å› JSON æ–‡æœ¬
```

**å‚æ•°è¯´æ˜**:
- `{country}`: å›½å®¶ä»£ç ï¼ˆå¦‚ï¼šID, PHï¼‰
- `{grade}`: å¹´çº§ï¼ˆå¦‚ï¼šKelas 3, Grade 2ï¼‰
- `{subject}`: å­¦ç§‘ï¼ˆå¦‚ï¼šMatematika, Mathematicsï¼‰
- `{results_context}`: æœç´¢ç»“æœä¸Šä¸‹æ–‡ï¼ˆæ ¼å¼ï¼š`ç»“æœ {i+1}:\næ ‡é¢˜: {title}\nURL: {url}\næ‘˜è¦: {snippet[:300]}`ï¼‰

**è¿”å›æ ¼å¼**:
```json
[
    {
        "index": 1,
        "score": 8.5,
        "recommendation_reason": "åŸºäºæ‘˜è¦åˆ¤æ–­ï¼šå†…å®¹é«˜åº¦ç›¸å…³ï¼Œæ¥è‡ªçŸ¥åæ•™è‚²å¹³å°ï¼Œæ ‡é¢˜æ¸…æ™°æ˜ç¡®"
    },
    {
        "index": 2,
        "score": 6.0,
        "recommendation_reason": "åŸºäºæ‘˜è¦åˆ¤æ–­ï¼šåŸºæœ¬ç›¸å…³ï¼Œä½†æ¥æºä¿¡æ¯ä¸è¶³"
    }
]
```

**æ‰¹é‡å¤„ç†**: æ¯æ¬¡æœ€å¤šè¯„ä¼° 10 ä¸ªç»“æœï¼Œå¦‚æœç»“æœè¶…è¿‡ 10 ä¸ªï¼Œä¼šåˆ†æ‰¹å¤„ç†ã€‚

---

## 5. æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 5.1 CountryDiscoveryAgentï¼ˆå›½å®¶å‘ç° Agentï¼‰

**æ–‡ä»¶**: `discovery_agent.py`

**èŒè´£**: AI é©±åŠ¨çš„å›½å®¶ä¿¡æ¯è°ƒç ”ç³»ç»Ÿ

**ä¸»è¦æ–¹æ³•**:
- `discover_country_profile(country_name: str) -> CountryProfile`: è°ƒç ”å›½å®¶æ•™è‚²ä½“ç³»ä¿¡æ¯
- `verify_and_enrich_subjects(profile: CountryProfile, country_name: str) -> CountryProfile`: å­¦ç§‘äº¤å‰éªŒè¯

**æµç¨‹**:
1. ä½¿ç”¨ Tavily æœç´¢å›½å®¶æ•™è‚²ä½“ç³»ä¿¡æ¯ï¼ˆ4ä¸ªæŸ¥è¯¢ï¼‰
2. æ”¶é›†æœç´¢ç»“æœï¼ˆæœ€å¤š40ä¸ªï¼‰
3. ä½¿ç”¨ LLMï¼ˆGemini 2.5 Proï¼‰æå–ç»“æ„åŒ–ä¿¡æ¯ï¼ˆPrompt 1ï¼‰
4. ä½¿ç”¨ LLMï¼ˆDeepSeekï¼‰éªŒè¯å’Œè¡¥å……å­¦ç§‘ï¼ˆPrompt 2ï¼‰
5. ä¿å­˜åˆ°é…ç½®æ–‡ä»¶

### 5.2 SearchEngineV2ï¼ˆæœç´¢å¼•æ“ï¼‰

**æ–‡ä»¶**: `search_engine_v2.py`

**èŒè´£**: æ‰§è¡Œæ•™è‚²è§†é¢‘æœç´¢

**ä¸»è¦æ–¹æ³•**:
- `search(request: SearchRequest) -> SearchResponse`: æ‰§è¡Œæœç´¢

**æµç¨‹**:
1. ç”Ÿæˆæœç´¢è¯ï¼ˆQueryGeneratorï¼ŒPrompt 3ï¼‰
2. æ‰§è¡Œæ··åˆæœç´¢ï¼š
   - æœç´¢Aï¼šé€šç”¨æœç´¢ï¼ˆTavilyï¼Œmax_results=15ï¼‰
   - æœç´¢Bï¼šæœ¬åœ°å®šå‘æœç´¢ï¼ˆå¦‚æœå›½å®¶é…ç½®ä¸­æœ‰åŸŸåï¼ŒTavily + include_domainsï¼Œmax_results=10ï¼‰
3. åˆå¹¶ç»“æœå¹¶å»é‡ï¼ˆåŸºäºURLï¼‰
4. è§„åˆ™è¯„ä¼°ï¼ˆç­›é€‰é«˜è´¨é‡èµ„æºï¼‰
5. LLMè¯„ä¼°ï¼ˆResultEvaluatorï¼ŒPrompt 4ï¼‰
6. è¿”å›ç»“æœ

### 5.3 QueryGeneratorï¼ˆæŸ¥è¯¢ç”Ÿæˆå™¨ï¼‰

**æ–‡ä»¶**: `search_engine_v2.py`

**èŒè´£**: ä½¿ç”¨ AI ç”Ÿæˆæœ¬åœ°è¯­è¨€çš„æœç´¢è¯

**ä¸»è¦æ–¹æ³•**:
- `generate_query(request: SearchRequest) -> str`: ç”Ÿæˆæœç´¢è¯

**æµç¨‹**:
1. ç¡®å®šç›®æ ‡è¯­è¨€ï¼ˆæ ¹æ®å›½å®¶ä»£ç æ˜ å°„ï¼‰
2. æ„å»º System Prompt å’Œ User Promptï¼ˆPrompt 3ï¼‰
3. è°ƒç”¨ LLMï¼ˆDeepSeekï¼‰ç”Ÿæˆæœç´¢è¯
4. æ¸…ç†å“åº”ï¼ˆç§»é™¤å¼•å·ï¼‰
5. å¦‚æœå¤±è´¥ï¼Œé™çº§ä¸ºé»˜è®¤æœç´¢è¯

### 5.4 ResultEvaluatorï¼ˆç»“æœè¯„ä¼°å™¨ï¼‰

**æ–‡ä»¶**: `result_evaluator.py`

**èŒè´£**: ä½¿ç”¨ LLM å¯¹æœç´¢ç»“æœè¿›è¡Œè¯„åˆ†å’Œæ¨è

**ä¸»è¦æ–¹æ³•**:
- `evaluate_results(results: List[SearchResult], country: str, grade: str, subject: str) -> List[SearchResult]`: è¯„ä¼°æœç´¢ç»“æœ

**æµç¨‹**:
1. åˆ†æ‰¹å¤„ç†ï¼ˆæ¯æ‰¹10ä¸ªç»“æœï¼‰
2. å¯¹æ¯æ‰¹è°ƒç”¨ LLMï¼ˆDeepSeekï¼ŒPrompt 4ï¼‰
3. è§£æ JSON å“åº”
4. æ›´æ–°ç»“æœçš„ score å’Œ recommendation_reason
5. æŒ‰åˆ†æ•°é™åºæ’åº
6. è¿”å›è¯„ä¼°åçš„ç»“æœ

### 5.5 ConfigManagerï¼ˆé…ç½®ç®¡ç†å™¨ï¼‰

**æ–‡ä»¶**: `config_manager.py`

**èŒè´£**: ç®¡ç†å›½å®¶é…ç½®æ•°æ®

**ä¸»è¦æ–¹æ³•**:
- `get_country_config(country_code: str) -> Optional[CountryConfig]`: è·å–å›½å®¶é…ç½®
- `update_country_config(profile: CountryProfile) -> None`: æ›´æ–°å›½å®¶é…ç½®
- `get_all_countries() -> List[Dict]`: è·å–æ‰€æœ‰å›½å®¶åˆ—è¡¨

**æ•°æ®å­˜å‚¨**: `countries_config.json`

---

## 6. API æ¥å£æ–‡æ¡£

### 6.1 æœç´¢ API

**ç«¯ç‚¹**: `POST /api/search`

**è¯·æ±‚ä½“**:
```json
{
    "country": "ID",
    "grade": "Kelas 3",
    "semester": "1",
    "subject": "Matematika",
    "language": "id"
}
```

**å“åº”**:
```json
{
    "success": true,
    "query": "playlist matematika kelas 3 SD kurikulum merdeka",
    "results": [
        {
            "title": "...",
            "url": "...",
            "snippet": "...",
            "score": 8.5,
            "recommendation_reason": "...",
            "is_selected": false
        }
    ],
    "total_count": 5,
    "playlist_count": 4,
    "video_count": 1,
    "message": "æœç´¢æˆåŠŸ",
    "timestamp": "2025-12-29T10:00:00"
}
```

### 6.2 å›½å®¶å‘ç° API

**ç«¯ç‚¹**: `POST /api/discover_country`

**è¯·æ±‚ä½“**:
```json
{
    "country_name": "Philippines"
}
```

**å“åº”**:
```json
{
    "success": true,
    "message": "æˆåŠŸè°ƒç ”å›½å®¶: Philippines",
    "profile": {
        "country_code": "PH",
        "country_name": "Philippines",
        ...
    }
}
```

### 6.3 è·å–å›½å®¶é…ç½® API

**ç«¯ç‚¹**: `GET /api/config/<country_code>`

**å“åº”**:
```json
{
    "success": true,
    "config": {
        "country_code": "PH",
        "country_name": "Philippines",
        ...
    }
}
```

### 6.4 å¯¼å‡º Excel API

**ç«¯ç‚¹**: `POST /api/export_excel`

**è¯·æ±‚ä½“**:
```json
{
    "selected_results": [...],
    "search_params": {...}
}
```

**å“åº”**: Excel æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶æµï¼‰

---

## 7. æ•°æ®æ¨¡å‹

### 7.1 CountryProfile

```python
class CountryProfile(BaseModel):
    country_code: str
    country_name: str
    country_name_zh: str = ""
    language_code: str
    grades: List[Dict[str, str]]  # [{"local_name": "...", "zh_name": "..."}]
    subjects: List[Dict[str, str]]  # [{"local_name": "...", "zh_name": "..."}]
    domains: List[str]  # ["ruangguru.com", "vidio.com"]
    notes: str = ""
```

### 7.2 SearchRequest

```python
class SearchRequest(BaseModel):
    country: str
    grade: str
    semester: Optional[str] = None
    subject: str
    language: Optional[str] = None
```

### 7.3 SearchResult

```python
class SearchResult(BaseModel):
    title: str
    url: str
    snippet: str = ""
    source: str = "è§„åˆ™"
    score: float = 0.0
    recommendation_reason: str = ""
    is_selected: bool = False
```

### 7.4 SearchResponse

```python
class SearchResponse(BaseModel):
    success: bool
    query: str
    results: List[SearchResult]
    total_count: int = 0
    playlist_count: int = 0
    video_count: int = 0
    message: str = ""
    timestamp: str
```

---

## 8. ä½¿ç”¨æµç¨‹

### 8.1 æ·»åŠ æ–°å›½å®¶

1. åœ¨ Web ç•Œé¢è¾“å…¥å›½å®¶åç§°ï¼ˆè‹±æ–‡ï¼‰
2. ç‚¹å‡»"å›½å®¶å‘ç°"æŒ‰é’®
3. ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œï¼š
   - Tavily æœç´¢æ•™è‚²ä½“ç³»ä¿¡æ¯
   - LLM æå–ç»“æ„åŒ–ä¿¡æ¯ï¼ˆPrompt 1ï¼‰
   - å­¦ç§‘äº¤å‰éªŒè¯ï¼ˆPrompt 2ï¼‰
   - ä¿å­˜é…ç½®
4. é…ç½®è‡ªåŠ¨ä¿å­˜åˆ° `countries_config.json`

### 8.2 æ‰§è¡Œæœç´¢

1. é€‰æ‹©å›½å®¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼Œå…ˆæ‰§è¡Œå›½å®¶å‘ç°ï¼‰
2. é€‰æ‹©å¹´çº§å’Œå­¦ç§‘
3. ç‚¹å‡»"æœç´¢"æŒ‰é’®
4. ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œï¼š
   - ç”Ÿæˆæœç´¢è¯ï¼ˆPrompt 3ï¼‰
   - æ‰§è¡Œæ··åˆæœç´¢ï¼ˆé€šç”¨ + æœ¬åœ°å®šå‘ï¼‰
   - è§„åˆ™è¯„ä¼°
   - LLM è¯„ä¼°ï¼ˆPrompt 4ï¼‰
5. æ˜¾ç¤ºç»“æœï¼ˆæŒ‰åˆ†æ•°æ’åºï¼‰

### 8.3 æ‰¹é‡æœç´¢

1. é€‰æ‹©å›½å®¶
2. å¹´çº§é€‰æ‹©"å…¨éƒ¨"æˆ–å­¦ç§‘é€‰æ‹©"å…¨éƒ¨"
3. ç‚¹å‡»"æœç´¢"æŒ‰é’®
4. ç³»ç»Ÿè‡ªåŠ¨ï¼š
   - ç”Ÿæˆæ‰€æœ‰å¹´çº§Ã—å­¦ç§‘ç»„åˆ
   - ä½¿ç”¨çº¿ç¨‹æ± å¹¶å‘æ‰§è¡Œï¼ˆmax_workers=4ï¼‰
   - æ”¶é›†æ‰€æœ‰ç»“æœå¹¶å»é‡
   - æ‰¹é‡ LLM è¯„ä¼°
5. æ˜¾ç¤ºåˆå¹¶åçš„ç»“æœ

---

## 9. é”™è¯¯å¤„ç†ä¸ä¼˜åŒ–

### 9.1 JSON è§£æé”™è¯¯å¤„ç†

**é—®é¢˜**: LLM è¿”å›çš„ JSON å¯èƒ½æ ¼å¼ä¸æ­£ç¡®ï¼ˆå•å¼•å·ã€markdown æ ‡è®°ç­‰ï¼‰

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå– JSON å—
2. ç§»é™¤ markdown ä»£ç å—æ ‡è®°ï¼ˆ```json, ```ï¼‰
3. å°è¯•ä¿®å¤å•å¼•å·ï¼ˆæ›¿æ¢ä¸ºåŒå¼•å·ï¼‰
4. å¦‚æœä»ç„¶å¤±è´¥ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–å…³é”®å­—æ®µ

**ä½ç½®**:
- `discovery_agent.py`: `_parse_llm_response()`, `_parse_missing_subjects()`
- `result_evaluator.py`: `_parse_evaluation_response()`

### 9.2 LLM è°ƒç”¨å¤±è´¥å¤„ç†

**é—®é¢˜**: LLM API å¯èƒ½è¿”å›ç©ºå†…å®¹æˆ–å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. DeepSeek å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨é™çº§åˆ° Gemini 2.5 Pro
2. å¦‚æœè¯„ä¼°å¤±è´¥ï¼Œä¿ç•™åŸå§‹ç»“æœï¼ˆåˆ†æ•°ä¸º0ï¼‰
3. å¦‚æœæœç´¢è¯ç”Ÿæˆå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æœç´¢è¯

**ä½ç½®**:
- `search_engine_v2.py`: `QueryGenerator.generate_query()`
- `result_evaluator.py`: `_evaluate_batch()`

### 9.3 å¹¶å‘æ§åˆ¶

**é—®é¢˜**: æ‰¹é‡æœç´¢æ—¶å¯èƒ½è§¦å‘ API é€Ÿç‡é™åˆ¶

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ `ThreadPoolExecutor`ï¼Œé™åˆ¶å¹¶å‘æ•°ä¸º 4
- æ¯ä¸ªä»»åŠ¡ç‹¬ç«‹å¤„ç†é”™è¯¯ï¼Œä¸å½±å“å…¶ä»–ä»»åŠ¡

**ä½ç½®**: `web_app.py`: `_batch_search()`

---

## 10. éƒ¨ç½²ä¸é…ç½®

### 10.1 ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
AI_BUILDER_TOKEN=your_token_here
```

### 10.2 ä¾èµ–å®‰è£…

```bash
pip install -r requirements_v3.txt
```

### 10.3 å¯åŠ¨åº”ç”¨

```bash
python3 web_app.py
```

æˆ–ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼š

```bash
./start_web_app.sh
```

### 10.4 æ—¥å¿—æ–‡ä»¶

- **æœç´¢ç³»ç»Ÿæ—¥å¿—**: `search_system.log`
- **Web åº”ç”¨æ—¥å¿—**: `web_app.log`

### 10.5 é…ç½®æ–‡ä»¶

- **å›½å®¶é…ç½®**: `countries_config.json`
- **æœç´¢å†å²**: `search_history.json`

---

## ğŸ“ é™„å½•

### A. æç¤ºè¯æœ€ä½³å®è·µ

1. **æ˜ç¡®è¾“å‡ºæ ¼å¼**: åœ¨ System Prompt å’Œ User Prompt ä¸­éƒ½æ˜ç¡®æŒ‡å®š JSON æ ¼å¼
2. **ç¦ç”¨å·¥å…·è°ƒç”¨**: å¯¹äºéœ€è¦çº¯æ–‡æœ¬è¾“å‡ºçš„åœºæ™¯ï¼Œè®¾ç½® `tool_choice="none"` å’Œ `tools=None`
3. **æ¸©åº¦è®¾ç½®**: 
   - æå–ä»»åŠ¡ï¼š0.2ï¼ˆæ›´å‡†ç¡®ï¼‰
   - ç”Ÿæˆä»»åŠ¡ï¼š0.3ï¼ˆå¹³è¡¡åˆ›é€ æ€§å’Œå‡†ç¡®æ€§ï¼‰
4. **é”™è¯¯å¤„ç†**: å§‹ç»ˆå‡†å¤‡é™çº§æ–¹æ¡ˆå’Œé»˜è®¤å€¼

### B. æ¨¡å‹é€‰æ‹©å»ºè®®

- **DeepSeek**: ç”¨äºæœç´¢è¯ç”Ÿæˆå’Œç»“æœè¯„ä¼°ï¼ˆæˆæœ¬ä½ï¼Œé€Ÿåº¦å¿«ï¼‰
- **Gemini 2.5 Pro**: ç”¨äºå¤æ‚çš„ä¿¡æ¯æå–ä»»åŠ¡ï¼ˆç†è§£èƒ½åŠ›å¼ºï¼‰

### C. æ€§èƒ½ä¼˜åŒ–

1. **æ‰¹é‡å¤„ç†**: ç»“æœè¯„ä¼°æ—¶ï¼Œæ¯æ‰¹å¤„ç† 10 ä¸ªç»“æœ
2. **å¹¶å‘æ§åˆ¶**: æ‰¹é‡æœç´¢æ—¶ï¼Œé™åˆ¶å¹¶å‘æ•°ä¸º 4
3. **ç»“æœç¼“å­˜**: å›½å®¶é…ç½®ä¿å­˜åœ¨ JSON æ–‡ä»¶ä¸­ï¼Œé¿å…é‡å¤è°ƒç ”
4. **å»é‡æœºåˆ¶**: åŸºäº URL å»é‡ï¼Œé¿å…é‡å¤ç»“æœ

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Flask æ–‡æ¡£](https://flask.palletsprojects.com/)
- [Pydantic æ–‡æ¡£](https://docs.pydantic.dev/)
- [AI Builders API æ–‡æ¡£](https://space.ai-builders.com/)
- [Tavily Search API æ–‡æ¡£](https://tavily.com/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: V3.1.0  
**æœ€åæ›´æ–°**: 2025-12-29  
**ç»´æŠ¤è€…**: AI Assistant

