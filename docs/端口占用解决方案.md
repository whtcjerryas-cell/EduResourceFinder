# 端口占用问题解决方案

## 🔍 问题诊断

从您的终端输出可以看到：

1. ✅ **日志系统正常启动**
   ```
   📝 日志系统启动 - 日志文件: /Users/shmiwanghao8/Desktop/education/Indonesia/search_system.log
   ```

2. ⚠️ **端口 5000 被占用**
   ```
   Address already in use
   Port 5000 is in use by another program
   ```

3. ⚠️ **日志重复输出**
   - 每条消息被记录了多次（这是正常的，因为 Flask 和我们的日志系统都在记录）

## ✅ 解决方案

### 步骤 1: 停止占用端口的进程

```bash
# 方法 1: 查找并停止进程
lsof -ti:5000 | xargs kill

# 方法 2: 使用重启脚本
./restart_web_app.sh

# 方法 3: 手动查找并停止
ps aux | grep "python.*web_app\|flask" | grep -v grep
kill <PID>
```

### 步骤 2: 验证端口已释放

```bash
lsof -ti:5000
# 如果没有输出，说明端口已释放
```

### 步骤 3: 重新启动 Web 应用

```bash
python3 web_app.py
```

## 📝 关于日志重复输出

**这是正常的**，原因：

1. **我们的日志系统**：通过 `logger_utils` 记录所有 `print()` 输出
2. **Flask 日志系统**：Flask 也会记录 HTTP 请求和响应
3. **Python logging**：Python 的标准日志系统也会记录

**每条消息会被记录 2-3 次**，这是预期的行为，因为：
- 控制台输出（通过 print）
- 日志文件记录（通过 logger.info）
- Flask 的日志系统

**不影响功能**，所有日志都会正确写入 `search_system.log` 文件。

## 🎯 快速重启

使用重启脚本（已自动处理端口释放）：

```bash
./restart_web_app.sh
```

## ✅ 验证

重启后，您应该看到：

```
================================================================================
📝 日志系统启动 - 日志文件: /Users/shmiwanghao8/Desktop/education/Indonesia/search_system.log
================================================================================
🚀 启动 Web 应用
================================================================================
访问地址: http://localhost:5000
...
 * Running on http://0.0.0.0:5000
```

然后执行一次搜索，查看日志文件：

```bash
tail -f search_system.log
```

