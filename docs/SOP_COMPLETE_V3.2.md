# K12 è§†é¢‘æœç´¢ç³»ç»Ÿ V3.2.0 - å®Œæ•´ SOP æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **ç‰ˆæœ¬**: V3.2.0
- **æœ€åæ›´æ–°**: 2025-12-30
- **çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
- **ä½œè€…**: AI Assistant

---

## ğŸ“‘ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [å®Œæ•´æµç¨‹å›¾](#3-å®Œæ•´æµç¨‹å›¾)
4. [LLM æç¤ºè¯å®Œæ•´æ¸…å•](#4-llm-æç¤ºè¯å®Œæ•´æ¸…å•)
5. [API æ¥å£æ–‡æ¡£](#5-api-æ¥å£æ–‡æ¡£)
6. [æ ¸å¿ƒç»„ä»¶è¯´æ˜](#6-æ ¸å¿ƒç»„ä»¶è¯´æ˜)
7. [æ•°æ®æ¨¡å‹](#7-æ•°æ®æ¨¡å‹)
8. [ä½¿ç”¨æµç¨‹](#8-ä½¿ç”¨æµç¨‹)
9. [é”™è¯¯å¤„ç†ä¸ä¼˜åŒ–](#9-é”™è¯¯å¤„ç†ä¸ä¼˜åŒ–)
10. [éƒ¨ç½²ä¸é…ç½®](#10-éƒ¨ç½²ä¸é…ç½®)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡

K12 è§†é¢‘æœç´¢ç³»ç»Ÿ V3.2.0 æ˜¯ä¸€ä¸ª**AI é©±åŠ¨çš„å¤šå›½å®¶ K12 æ•™è‚²è§†é¢‘æœç´¢å’Œè¯„ä¼°ç³»ç»Ÿ**ï¼Œæ—¨åœ¨ä¸ºä¸åŒå›½å®¶çš„ K12 æ•™è‚²ä½“ç³»è‡ªåŠ¨æœç´¢ã€è¯„ä¼°é«˜è´¨é‡çš„æ•™è‚²è§†é¢‘èµ„æºã€‚

### 1.2 æ ¸å¿ƒç‰¹æ€§

1. **AI é©±åŠ¨çš„å›½å®¶è‡ªåŠ¨æ¥å…¥**ï¼šé€šè¿‡ UI äº¤äº’ï¼ŒAI è‡ªåŠ¨è°ƒç ”å¹¶é…ç½®æ–°å›½å®¶çš„æ•™è‚²ä½“ç³»ä¿¡æ¯
2. **æ™ºèƒ½æœç´¢ç­–ç•¥ Agent**ï¼šæ ¹æ®å›½å®¶ã€å¹´çº§ã€ç§‘ç›®åˆ¶å®šä¸ªæ€§åŒ–çš„æœç´¢ç­–ç•¥ï¼ˆæ–°å¢ï¼‰
3. **æ™ºèƒ½æœç´¢è¯ç”Ÿæˆ**ï¼šæ ¹æ®å›½å®¶ã€å¹´çº§ã€å­¦ç§‘è‡ªåŠ¨ç”Ÿæˆæœ¬åœ°è¯­è¨€çš„æœç´¢è¯
4. **æ··åˆæœç´¢ç­–ç•¥**ï¼šé€šç”¨æœç´¢ï¼ˆYouTubeï¼‰+ æœ¬åœ°å®šå‘æœç´¢ï¼ˆæœ¬åœ°è§†é¢‘å¹³å°ï¼‰
5. **ç»“æœè¯„ä¼°**ï¼šä½¿ç”¨ LLM å¯¹æœç´¢ç»“æœè¿›è¡Œ 0-10 åˆ†è¯„åˆ†ï¼Œå¹¶æä¾›æ¨èç†ç”±
6. **è§†é¢‘æ·±åº¦è¯„ä¼°**ï¼šå¤šç»´åº¦è¯„ä¼°è§†é¢‘è´¨é‡ï¼ˆè§†è§‰è´¨é‡ã€å†…å®¹ç›¸å…³åº¦ã€æ•™å­¦è´¨é‡ã€çƒ­åº¦ï¼‰
7. **çŸ¥è¯†ç‚¹åŒ¹é…**ï¼šè‡ªåŠ¨åŒ¹é…è§†é¢‘åˆ°çŸ¥è¯†ç‚¹ï¼Œæ”¯æŒçŸ¥è¯†ç‚¹æ¦‚è§ˆå±•ç¤º
8. **å­¦ç§‘äº¤å‰éªŒè¯**ï¼šè‡ªåŠ¨éªŒè¯å’Œè¡¥å……é—æ¼çš„æ ¸å¿ƒå­¦ç§‘
9. **æ‰¹é‡æœç´¢**ï¼šæ”¯æŒ"å…¨éƒ¨"é€‰é¡¹ï¼Œè‡ªåŠ¨æ‰¹é‡æœç´¢æ‰€æœ‰å¹´çº§/å­¦ç§‘ç»„åˆï¼ˆå¹¶å‘æ‰§è¡Œï¼‰
10. **å†å²ç®¡ç†**ï¼šæ”¯æŒæœç´¢å†å²ç­›é€‰å’Œæ‰¹é‡å¯¼å‡º Excel
11. **Debugæ—¥å¿—ç³»ç»Ÿ**ï¼šå®Œæ•´çš„æ—¥å¿—è®°å½•å’Œå¯¼å‡ºåŠŸèƒ½

### 1.3 æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Flask 2.3+
- **æ•°æ®éªŒè¯**: Pydantic 2.0+
- **LLM API**: AI Builders API (DeepSeek, Grok-4-Fast, Gemini 2.5 Pro)
- **æœç´¢å¼•æ“**: Tavily Search (é€šè¿‡ AI Builders API)
- **è§†è§‰åˆ†æ**: å°è±†åŒ…å¹³å° Vision API (gpt-4o)
- **è§†é¢‘å¤„ç†**: yt-dlp, ffmpeg-python, Whisper
- **æ•°æ®å¤„ç†**: Pandas 2.0+, OpenPyXL 3.1+
- **å¹¶å‘å¤„ç†**: ThreadPoolExecutor
- **æ—¥å¿—ç³»ç»Ÿ**: Python logging + è‡ªå®šä¹‰æ—¥å¿—å·¥å…·

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        UI[Webç•Œé¢<br/>templates/index.html]
        KP[çŸ¥è¯†ç‚¹æ¦‚è§ˆ<br/>templates/knowledge_points.html]
    end
    
    subgraph "APIå±‚"
        API1[POST /api/search<br/>æœç´¢API]
        API2[POST /api/discover_country<br/>å›½å®¶å‘ç°API]
        API3[GET /api/config/<country_code><br/>è·å–é…ç½®API]
        API4[GET /api/countries<br/>è·å–å›½å®¶åˆ—è¡¨API]
        API5[POST /api/export_excel<br/>å¯¼å‡ºExcel API]
        API6[GET /api/debug_logs<br/>è·å–æ—¥å¿—API]
        API7[POST /api/save_debug_log<br/>ä¿å­˜æ—¥å¿—API]
        API8[POST /api/analyze_video<br/>è§†é¢‘è¯„ä¼°API]
        API9[POST /api/batch_evaluate_videos<br/>æ‰¹é‡è¯„ä¼°API]
        API10[GET /api/knowledge_point_overview<br/>çŸ¥è¯†ç‚¹æ¦‚è§ˆAPI]
    end
    
    subgraph "ä¸šåŠ¡é€»è¾‘å±‚"
        SE[SearchEngineV2<br/>æœç´¢å¼•æ“]
        SSA[SearchStrategyAgent<br/>æœç´¢ç­–ç•¥Agent]
        DA[CountryDiscoveryAgent<br/>å›½å®¶å‘ç°Agent]
        RE[ResultEvaluator<br/>ç»“æœè¯„ä¼°å™¨]
        VE[VideoEvaluator<br/>è§†é¢‘è¯„ä¼°å™¨]
        CM[ConfigManager<br/>é…ç½®ç®¡ç†å™¨]
    end
    
    subgraph "AIæœåŠ¡å±‚"
        AC[AIBuildersClient<br/>AIå®¢æˆ·ç«¯]
        QG[QueryGenerator<br/>æŸ¥è¯¢ç”Ÿæˆå™¨]
        VC[VisionClient<br/>è§†è§‰åˆ†æå®¢æˆ·ç«¯]
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡"
        TAVILY[Tavily Search API<br/>æœç´¢å¼•æ“]
        LLM1[DeepSeek API<br/>æ–‡æœ¬ç”Ÿæˆ]
        LLM2[Grok-4-Fast API<br/>ç»“æ„åŒ–è¾“å‡º]
        LLM3[Gemini 2.5 Pro API<br/>ç»“æ„åŒ–æå–]
        VISION[å°è±†åŒ… Vision API<br/>è§†è§‰åˆ†æ]
    end
    
    subgraph "æ•°æ®å±‚"
        CFG[countries_config.json<br/>å›½å®¶é…ç½®]
        HIST[search_history.json<br/>æœç´¢å†å²]
        EVAL[evaluations/<br/>è¯„ä¼°è®°å½•]
        KP[knowledge_points/<br/>çŸ¥è¯†ç‚¹æ–‡ä»¶]
        LOG[search_system.log<br/>ç³»ç»Ÿæ—¥å¿—]
    end
    
    UI --> API1
    UI --> API2
    UI --> API3
    UI --> API8
    UI --> API9
    KP --> API10
    
    API1 --> SE
    API2 --> DA
    API8 --> VE
    API9 --> VE
    API10 --> VE
    
    SE --> SSA
    SE --> QG
    SE --> RE
    SSA --> AC
    QG --> AC
    RE --> AC
    DA --> AC
    VE --> AC
    VE --> VC
    
    AC --> LLM1
    AC --> LLM2
    AC --> LLM3
    AC --> TAVILY
    VC --> VISION
    
    SE --> CM
    DA --> CM
    CM --> CFG
    SE --> HIST
    VE --> EVAL
    VE --> KP
```

---

## 3. å®Œæ•´æµç¨‹å›¾

### 3.1 ä¸»æµç¨‹å›¾

```mermaid
flowchart TB
    Start([ç”¨æˆ·è®¿é—®ç³»ç»Ÿ]) --> LoadPage[åŠ è½½é¡µé¢]
    LoadPage --> LoadCountries[åŠ è½½å›½å®¶åˆ—è¡¨]
    LoadCountries --> SelectCountry{é€‰æ‹©å›½å®¶}
    
    SelectCountry -->|å›½å®¶ä¸å­˜åœ¨| DiscoverCountry[å›½å®¶å‘ç°æµç¨‹]
    SelectCountry -->|å›½å®¶å­˜åœ¨| SelectGrade[é€‰æ‹©å¹´çº§/å­¦ç§‘]
    
    DiscoverCountry --> SearchInfo[æœç´¢æ•™è‚²ä½“ç³»ä¿¡æ¯]
    SearchInfo --> ExtractInfo[LLMæå–ä¿¡æ¯<br/>Prompt 1]
    ExtractInfo --> VerifySubjects[å­¦ç§‘äº¤å‰éªŒè¯<br/>Prompt 2]
    VerifySubjects --> SaveConfig[ä¿å­˜é…ç½®]
    SaveConfig --> SelectGrade
    
    SelectGrade --> Search[å‘èµ·æœç´¢]
    
    Search --> GenerateStrategy[ç”Ÿæˆæœç´¢ç­–ç•¥<br/>Prompt 5]
    GenerateStrategy --> GenerateQuery[ç”Ÿæˆæœç´¢è¯<br/>Prompt 3]
    GenerateQuery --> GeneralSearch[é€šç”¨æœç´¢<br/>YouTubeç­‰]
    GenerateQuery --> LocalSearch[æœ¬åœ°å®šå‘æœç´¢<br/>site:domain]
    
    GeneralSearch --> MergeResults[åˆå¹¶å»é‡]
    LocalSearch --> MergeResults
    
    MergeResults --> RuleFilter[è§„åˆ™ç­›é€‰]
    RuleFilter --> LLMScore[LLMè¯„åˆ†<br/>Prompt 4]
    LLMScore --> DisplayResults[æ˜¾ç¤ºç»“æœ]
    
    DisplayResults --> UserAction{ç”¨æˆ·æ“ä½œ}
    UserAction -->|å¯¼å‡º| ExportExcel[å¯¼å‡ºExcel]
    UserAction -->|è¯„ä¼°| EvaluateVideo[è§†é¢‘æ·±åº¦è¯„ä¼°]
    UserAction -->|æŸ¥çœ‹æ¦‚è§ˆ| KnowledgeOverview[çŸ¥è¯†ç‚¹æ¦‚è§ˆ]
    
    EvaluateVideo --> DownloadVideo[ä¸‹è½½è§†é¢‘]
    DownloadVideo --> ExtractData[æå–å…ƒæ•°æ®/å…³é”®å¸§/å­—å¹•]
    ExtractData --> MatchKP[åŒ¹é…çŸ¥è¯†ç‚¹<br/>Prompt 6]
    MatchKP --> EvalVisual[è¯„ä¼°è§†è§‰è´¨é‡<br/>Vision API]
    EvalVisual --> EvalRelevance[è¯„ä¼°å†…å®¹ç›¸å…³åº¦<br/>Prompt 7]
    EvalRelevance --> EvalPedagogy[è¯„ä¼°æ•™å­¦è´¨é‡<br/>Prompt 8]
    EvalPedagogy --> EvalMetadata[è¯„ä¼°çƒ­åº¦/å…ƒæ•°æ®]
    EvalMetadata --> ShowEvalResult[æ˜¾ç¤ºè¯„ä¼°ç»“æœ]
    
    KnowledgeOverview --> FilterKP[ç­›é€‰çŸ¥è¯†ç‚¹]
    FilterKP --> ShowKP[æ˜¾ç¤ºçŸ¥è¯†ç‚¹ç»Ÿè®¡]
    ShowKP --> ShowVideos[æ˜¾ç¤ºè§†é¢‘æŸ±çŠ¶å›¾]
    ShowVideos --> ShowDetail[æ˜¾ç¤ºè§†é¢‘è¯¦æƒ…]
    
    style ExtractInfo fill:#fff4e1
    style VerifySubjects fill:#e8f5e9
    style GenerateStrategy fill:#e3f2fd
    style GenerateQuery fill:#fff4e1
    style LLMScore fill:#e8f5e9
    style MatchKP fill:#fff4e1
    style EvalRelevance fill:#e8f5e9
    style EvalPedagogy fill:#e8f5e9
    style EvalVisual fill:#f3e5f5
```

### 3.2 æœç´¢æµç¨‹è¯¦ç»†å›¾

```mermaid
flowchart LR
    Start([æœç´¢è¯·æ±‚]) --> Strategy[æœç´¢ç­–ç•¥Agent<br/>Prompt 5]
    Strategy -->|ç­–ç•¥| QueryGen[æŸ¥è¯¢ç”Ÿæˆå™¨<br/>Prompt 3]
    QueryGen -->|æœç´¢è¯| SearchA[é€šç”¨æœç´¢<br/>Tavily]
    Strategy -->|ä¼˜å…ˆåŸŸå| SearchB[æœ¬åœ°å®šå‘æœç´¢<br/>site:domain]
    
    SearchA --> ResultsA[ç»“æœA]
    SearchB --> ResultsB[ç»“æœB]
    
    ResultsA --> Merge[åˆå¹¶å»é‡]
    ResultsB --> Merge
    
    Merge --> Filter[è§„åˆ™ç­›é€‰]
    Filter -->|åŒ¹é…ç»“æœ| LLMEval[LLMè¯„ä¼°<br/>Prompt 4]
    LLMEval -->|è¯„åˆ†| Sort[æŒ‰åˆ†æ•°æ’åº]
    Sort --> Return([è¿”å›ç»“æœ])
    
    style Strategy fill:#e3f2fd
    style QueryGen fill:#fff4e1
    style LLMEval fill:#e8f5e9
```

### 3.3 è§†é¢‘è¯„ä¼°æµç¨‹è¯¦ç»†å›¾

```mermaid
flowchart TB
    Start([è§†é¢‘è¯„ä¼°è¯·æ±‚]) --> LoadKP[åŠ è½½çŸ¥è¯†ç‚¹åˆ—è¡¨]
    LoadKP --> Download[ä¸‹è½½è§†é¢‘<br/>480p]
    Download --> ExtractMeta[æå–å…ƒæ•°æ®]
    Download --> ExtractFrames[æå–å…³é”®å¸§<br/>6å¼ ]
    Download --> ExtractAudio[æå–éŸ³é¢‘]
    
    ExtractAudio --> ExtractSubtitle{æå–å­—å¹•}
    ExtractSubtitle -->|æœ‰å®˜æ–¹å­—å¹•| UseSubtitle[ä½¿ç”¨å®˜æ–¹å­—å¹•]
    ExtractSubtitle -->|æ— å®˜æ–¹å­—å¹•| Whisper[Whisperè½¬å½•]
    
    UseSubtitle --> MatchKP[åŒ¹é…çŸ¥è¯†ç‚¹<br/>Prompt 6]
    Whisper --> MatchKP
    
    MatchKP --> EvalVisual[è¯„ä¼°è§†è§‰è´¨é‡]
    EvalVisual --> VisionAPI[Vision APIåˆ†æ<br/>gpt-4o]
    VisionAPI --> VisualScore[è§†è§‰è´¨é‡åˆ†æ•°]
    
    MatchKP --> EvalRelevance[è¯„ä¼°å†…å®¹ç›¸å…³åº¦<br/>Prompt 7]
    EvalRelevance --> RelevanceScore[ç›¸å…³åº¦åˆ†æ•°]
    
    MatchKP --> EvalPedagogy[è¯„ä¼°æ•™å­¦è´¨é‡<br/>Prompt 8]
    EvalPedagogy --> PedagogyScore[æ•™å­¦è´¨é‡åˆ†æ•°]
    
    ExtractMeta --> EvalMetadata[è¯„ä¼°çƒ­åº¦/å…ƒæ•°æ®]
    EvalMetadata --> MetadataScore[çƒ­åº¦åˆ†æ•°]
    
    VisualScore --> Calculate[è®¡ç®—æ€»åˆ†]
    RelevanceScore --> Calculate
    PedagogyScore --> Calculate
    MetadataScore --> Calculate
    
    Calculate --> SaveResult[ä¿å­˜è¯„ä¼°ç»“æœ]
    SaveResult --> Return([è¿”å›è¯„ä¼°ç»“æœ])
    
    style MatchKP fill:#fff4e1
    style EvalRelevance fill:#e8f5e9
    style EvalPedagogy fill:#e8f5e9
    style VisionAPI fill:#f3e5f5
```

---

## 4. LLM æç¤ºè¯å®Œæ•´æ¸…å•

### 4.1 æç¤ºè¯æ€»è§ˆè¡¨

| åºå· | æç¤ºè¯åç§° | ä½¿ç”¨åœºæ™¯ | æ–‡ä»¶ä½ç½® | LLM æ¨¡å‹ | Temperature | Max Tokens | è¿”å›æ ¼å¼ | ç¦ç”¨å·¥å…· |
|------|-----------|---------|---------|----------|-------------|------------|----------|---------|
| 1 | å›½å®¶ä¿¡æ¯æå– | ä»æœç´¢ç»“æœæå–å›½å®¶æ•™è‚²ä½“ç³»ä¿¡æ¯ | `discovery_agent.py` | Gemini 2.5 Pro | 0.2 | 4000 | JSON å¯¹è±¡ | âŒ |
| 2 | å­¦ç§‘äº¤å‰éªŒè¯ | éªŒè¯å’Œè¡¥å……é—æ¼çš„æ ¸å¿ƒå­¦ç§‘ | `discovery_agent.py` | DeepSeek | 0.2 | 1000 | JSON æ•°ç»„ | âœ… |
| 3 | æœç´¢è¯ç”Ÿæˆ | æ ¹æ®å›½å®¶/å¹´çº§/å­¦ç§‘ç”Ÿæˆæœç´¢è¯ | `search_engine_v2.py` | DeepSeek | 0.2 | 50 | çº¯æ–‡æœ¬ | âœ… |
| 4 | ç»“æœè¯„ä¼° | å¯¹æœç´¢ç»“æœè¯„åˆ†å’Œæ¨è | `search_engine_v2.py` | DeepSeek | 0.3 | 1500 | JSON æ•°ç»„ | âœ… |
| 5 | æœç´¢ç­–ç•¥ç”Ÿæˆ | åˆ¶å®šä¸ªæ€§åŒ–æœç´¢ç­–ç•¥ | `search_strategy_agent.py` | Grok-4-Fast | 0.2 | 500 | JSON å¯¹è±¡ | âœ… |
| 6 | çŸ¥è¯†ç‚¹åŒ¹é… | åŒ¹é…è§†é¢‘åˆ°çŸ¥è¯†ç‚¹ | `core/video_evaluator.py` | DeepSeek | 0.3 | 500 | JSON å¯¹è±¡ | âœ… |
| 7 | å†…å®¹ç›¸å…³åº¦è¯„ä¼° | è¯„ä¼°è§†é¢‘å†…å®¹ä¸çŸ¥è¯†ç‚¹ç›¸å…³åº¦ | `core/video_evaluator.py` | Grok-4-Fast | 0.1 | 300 | JSON å¯¹è±¡ | âœ… |
| 8 | æ•™å­¦è´¨é‡è¯„ä¼° | è¯„ä¼°è§†é¢‘æ•™å­¦è´¨é‡ | `core/video_evaluator.py` | Grok-4-Fast | 0.1 | 300 | JSON å¯¹è±¡ | âœ… |
| 9 | è§†è§‰è´¨é‡è¯„ä¼° | è¯„ä¼°è§†é¢‘è§†è§‰è®¾è®¡è´¨é‡ | `core/video_evaluator.py` | gpt-4o (Vision) | 0.3 | 500 | JSON å¯¹è±¡ | âœ… |

---

### 4.2 æç¤ºè¯ 1: å›½å®¶ä¿¡æ¯æå–ï¼ˆCountry Profile Extractionï¼‰

**æ–‡ä»¶ä½ç½®**: `discovery_agent.py` (ç¬¬ 115-192 è¡Œ)

**ç”¨é€”**: ä» Tavily æœç´¢ç»“æœä¸­æå–å›½å®¶ K12 æ•™è‚²ä½“ç³»çš„ç»“æ„åŒ–ä¿¡æ¯

**æ¨¡å‹**: Gemini 2.5 Pro

**å‚æ•°é…ç½®**:
- `temperature`: 0.2
- `max_tokens`: 4000
- `tool_choice`: é»˜è®¤ï¼ˆå…è®¸å·¥å…·è°ƒç”¨ï¼‰

**è°ƒç”¨æ–¹æ³•**: `client.call_gemini()`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªæ•™è‚²ä½“ç³»åˆ†æä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯åˆ†ææœç´¢ç»“æœï¼Œæå–æŒ‡å®šå›½å®¶çš„ K12 æ•™è‚²ä½“ç³»ä¿¡æ¯ã€‚

**å…³é”®è¦æ±‚**ï¼š
1. **å¹´çº§è¡¨è¾¾å¿…é¡»ä½¿ç”¨å½“åœ°è¯­è¨€**ï¼šä¾‹å¦‚å°å°¼æ˜¯ "Kelas 1-12"ï¼Œè²å¾‹å®¾æ˜¯ "Kindergarten, Grade 1-12"ï¼Œæ—¥æœ¬æ˜¯ "å°å­¦1å¹´ç”Ÿ-6å¹´ç”Ÿ, ä¸­å­¦1å¹´ç”Ÿ-3å¹´ç”Ÿ"
2. **å­¦ç§‘åç§°å¿…é¡»ä½¿ç”¨å½“åœ°è¯­è¨€**ï¼šä¾‹å¦‚å°å°¼æ˜¯ "Matematika, IPA, IPS"ï¼Œè²å¾‹å®¾æ˜¯ "Math, Science, Filipino, Araling Panlipunan"ï¼Œæ—¥æœ¬æ˜¯ "å›½èª, ç®—æ•°, ç†ç§‘, ç¤¾ä¼š"
3. **è¯­è¨€ä»£ç **ï¼šä½¿ç”¨ ISO 639-1 æ ‡å‡†ï¼ˆå¦‚ï¼šid, en, ja, fil, msï¼‰
4. **å›½å®¶ä»£ç **ï¼šä½¿ç”¨ ISO 3166-1 alpha-2 æ ‡å‡†ï¼ˆå¦‚ï¼šID, PH, JP, MY, SGï¼‰

è¯·ä»”ç»†åˆ†ææœç´¢ç»“æœï¼Œæå–å‡†ç¡®çš„ä¿¡æ¯ã€‚
```

#### User Prompt

```
è¯·åˆ†æä»¥ä¸‹å…³äº {country_name} çš„ K12 æ•™è‚²ä½“ç³»æœç´¢ç»“æœï¼Œæå–ä»¥ä¸‹ä¿¡æ¯ï¼š

**éœ€è¦æå–çš„ä¿¡æ¯**ï¼š
1. **å›½å®¶ä»£ç **ï¼ˆISO 3166-1 alpha-2ï¼Œå¦‚ï¼šID, PH, JPï¼‰
2. **å›½å®¶åç§°**ï¼ˆè‹±æ–‡æ ‡å‡†åç§°ï¼‰
3. **å›½å®¶ä¸­æ–‡åç§°**ï¼ˆä¸­æ–‡æ ‡å‡†åç§°ï¼Œå¦‚ï¼šè²å¾‹å®¾ã€æ—¥æœ¬ã€å°å°¼ï¼‰
4. **ä¸»è¦è¯­è¨€ä»£ç **ï¼ˆISO 639-1ï¼Œå¦‚ï¼šid, en, jaï¼‰
5. **å¹´çº§è¡¨è¾¾åˆ—è¡¨**ï¼ˆæ¯ä¸ªå¹´çº§åŒ…å«å½“åœ°è¯­è¨€åç§°å’Œä¸­æ–‡åç§°ï¼‰
6. **æ ¸å¿ƒå­¦ç§‘åˆ—è¡¨**ï¼ˆæ¯ä¸ªå­¦ç§‘åŒ…å«å½“åœ°è¯­è¨€åç§°å’Œä¸­æ–‡åç§°ï¼‰
7. **EdTech åŸŸåç™½åå•**ï¼ˆè¯¥å›½çš„åœ¨çº¿æ•™è‚²å¹³å°åŸŸåï¼ŒåŒ…æ‹¬ä¸¤ç±»ï¼‰ï¼š
   a. **EdTech å¹³å°**ï¼šå¦‚ Khan Academy, Ruangguru, Zenius, Coursera ç­‰åœ¨çº¿æ•™è‚²å¹³å°
   b. **æœ¬åœ°è§†é¢‘æ‰˜ç®¡å¹³å°**ï¼šå¦‚ Rutubeï¼ˆä¿„ç½—æ–¯ï¼‰, Bilibiliï¼ˆä¸­å›½ï¼‰, Vidioï¼ˆå°å°¼ï¼‰, Dailymotionï¼ˆæ³•å›½ï¼‰ç­‰æœ¬åœ°è§†é¢‘å¹³å°
8. **é¢å¤–è¯´æ˜**ï¼ˆå¦‚æœ‰ï¼‰

**æœç´¢ç»“æœ**ï¼š
{search_context}

**é‡è¦**ï¼š
- å¹´çº§å’Œå­¦ç§‘åç§°å¿…é¡»ä½¿ç”¨**å½“åœ°è¯­è¨€**ï¼ŒåŒæ—¶æä¾›å¯¹åº”çš„ä¸­æ–‡ç¿»è¯‘
- å¦‚æœæœç´¢ç»“æœä¸­æ²¡æœ‰æ˜ç¡®ä¿¡æ¯ï¼Œè¯·åŸºäºè¯¥å›½çš„æ•™è‚²ä½“ç³»å¸¸è¯†è¿›è¡Œåˆç†æ¨æ–­
- å¹´çº§åˆ—è¡¨åº”è¯¥è¦†ç›– K12 çš„æ‰€æœ‰å¹´çº§ï¼ˆé€šå¸¸æ˜¯ 12-13 ä¸ªå¹´çº§ï¼‰
- å­¦ç§‘åˆ—è¡¨åº”è¯¥åŒ…å«è¯¥å›½çš„æ ¸å¿ƒå­¦ç§‘ï¼ˆè‡³å°‘ 5-8 ä¸ªï¼‰
- **åŸŸåæå–**ï¼šå¿…é¡»åŒæ—¶æå– EdTech å¹³å°å’Œæœ¬åœ°è§†é¢‘æ‰˜ç®¡å¹³å°ä¸¤ç±»åŸŸåï¼Œç¡®ä¿è¦†ç›–è¯¥å›½çš„ä¸»è¦åœ¨çº¿æ•™è‚²èµ„æºå¹³å°

**é‡è¦**ï¼šè¯·åªè¿”å›æœ‰æ•ˆçš„ JSON å¯¹è±¡ï¼Œä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡æœ¬ã€è§£é‡Šæˆ– markdown æ ‡è®°ã€‚ç›´æ¥è¿”å› JSONï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

{
    "country_code": "PH",
    "country_name": "Philippines",
    "country_name_zh": "è²å¾‹å®¾",
    "language_code": "en",
    "grades": [
        {"local_name": "Kindergarten", "zh_name": "å¹¼å„¿å›­"},
        {"local_name": "Grade 1", "zh_name": "ä¸€å¹´çº§"},
        ...
    ],
    "subjects": [
        {"local_name": "Math", "zh_name": "æ•°å­¦"},
        {"local_name": "Science", "zh_name": "ç§‘å­¦"},
        ...
    ],
    "domains": [
        "deped.gov.ph",
        "khanacademy.org",
        "rutube.ru",
        "bilibili.com"
    ],
    "notes": "è²å¾‹å®¾ä½¿ç”¨è‹±è¯­å’Œè²å¾‹å®¾è¯­åŒè¯­æ•™å­¦"
}

**æ³¨æ„**ï¼š
- language_code å¿…é¡»æ˜¯å•ä¸ªå­—ç¬¦ä¸²ï¼ˆå¦‚ "en"ï¼‰ï¼Œä¸æ˜¯æ•°ç»„
- grades å’Œ subjects å¿…é¡»æ˜¯å¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å« local_name å’Œ zh_name
- ç›´æ¥è¿”å› JSONï¼Œä¸è¦æ·»åŠ ä»»ä½•å‰ç¼€æˆ–åç¼€
```

---

### 4.3 æç¤ºè¯ 2: å­¦ç§‘äº¤å‰éªŒè¯ï¼ˆSubject Cross-Verificationï¼‰

**æ–‡ä»¶ä½ç½®**: `discovery_agent.py` (ç¬¬ 264-307 è¡Œ)

**ç”¨é€”**: å®¡æŸ¥å·²æå–çš„å­¦ç§‘åˆ—è¡¨ï¼Œæ‰¾å‡ºé—æ¼çš„æ ¸å¿ƒå­¦ç§‘

**æ¨¡å‹**: DeepSeek

**å‚æ•°é…ç½®**:
- `temperature`: 0.2
- `max_tokens`: 1000
- `tool_choice`: ç¦ç”¨ï¼ˆä¸è®¾ç½® tool_choice å’Œ toolsï¼‰

**è°ƒç”¨æ–¹æ³•**: `client.call_llm()`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ª{country_name}çš„ K12 æ•™è‚²ä½“ç³»ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å®¡æŸ¥å·²æå–çš„å­¦ç§‘åˆ—è¡¨ï¼Œå¯¹æ¯”è¯¥å›½å®˜æ–¹ K12 è¯¾ç¨‹å¤§çº²ï¼Œæ‰¾å‡ºè¢«é—æ¼çš„æ ¸å¿ƒå­¦ç§‘ï¼ˆCore Subjectsï¼‰ã€‚

**é‡è¦åŸåˆ™**ï¼š
1. åªè¯†åˆ«**æ ¸å¿ƒå­¦ç§‘**ï¼ˆCore Subjectsï¼‰ï¼Œè¿™äº›å­¦ç§‘é€šå¸¸æ˜¯ï¼š
   - è¯­è¨€ç±»ï¼šæ¯è¯­ã€å¤–è¯­ã€åœ°æ–¹è¯­è¨€
   - æ•°å­¦ç±»ï¼šæ•°å­¦ã€ç®—æœ¯
   - ç§‘å­¦ç±»ï¼šè‡ªç„¶ç§‘å­¦ã€ç‰©ç†ã€åŒ–å­¦ã€ç”Ÿç‰©
   - ç¤¾ä¼šç±»ï¼šå†å²ã€åœ°ç†ã€ç¤¾ä¼šç ”ç©¶ã€å…¬æ°‘æ•™è‚²
   - è‰ºæœ¯ç±»ï¼šéŸ³ä¹ã€ç¾æœ¯ã€è‰ºæœ¯
   - ä½“è‚²ç±»ï¼šä½“è‚²ã€å¥åº·
   - æŠ€æœ¯ç±»ï¼šä¿¡æ¯æŠ€æœ¯ã€æŠ€æœ¯æ•™è‚²
   - ä»·å€¼è§‚ç±»ï¼šé“å¾·æ•™è‚²ã€å®—æ•™æ•™è‚²

2. **ä¸è¦**åŒ…æ‹¬é€‰ä¿®è¯¾ã€å…´è¶£ç­ã€è¯¾å¤–æ´»åŠ¨ç­‰éæ ¸å¿ƒå­¦ç§‘

3. å¦‚æœå½“å‰åˆ—è¡¨å·²ç»å®Œæ•´ï¼Œè¿”å›ç©ºæ•°ç»„

4. æ¯ä¸ªé—æ¼çš„å­¦ç§‘å¿…é¡»åŒ…å«ï¼š
   - local_nameï¼šä½¿ç”¨è¯¥å›½å½“åœ°è¯­è¨€çš„å­¦ç§‘åç§°
   - zh_nameï¼šå¯¹åº”çš„ä¸­æ–‡åç§°

5. åªè¿”å› JSON æ•°ç»„ï¼Œä¸è¦å…¶ä»–æ–‡å­—
```

#### User Prompt

```
è¯·å®¡æŸ¥ä»¥ä¸‹å…³äº {country_name} çš„ K12 æ•™è‚²ä½“ç³»å·²æå–çš„å­¦ç§‘åˆ—è¡¨ï¼š

**å½“å‰å­¦ç§‘åˆ—è¡¨**ï¼š
{current_subjects_list}

**ä»»åŠ¡**ï¼š
å¯¹æ¯” {country_name} çš„å®˜æ–¹ K12 è¯¾ç¨‹å¤§çº²ï¼Œæ‰¾å‡ºè¢«é—æ¼çš„æ ¸å¿ƒå­¦ç§‘ã€‚

**è¦æ±‚**ï¼š
1. åªè¯†åˆ«æ ¸å¿ƒå­¦ç§‘ï¼ˆCore Subjectsï¼‰ï¼Œä¸åŒ…æ‹¬é€‰ä¿®è¯¾
2. å¦‚æœåˆ—è¡¨å·²ç»å®Œæ•´ï¼Œè¿”å›ç©ºæ•°ç»„ []
3. æ¯ä¸ªé—æ¼çš„å­¦ç§‘å¿…é¡»ä½¿ç”¨å½“åœ°è¯­è¨€åç§°ï¼Œå¹¶æä¾›ä¸­æ–‡ç¿»è¯‘
4. åªè¿”å› JSON æ•°ç»„æ ¼å¼ï¼Œä¸è¦å…¶ä»–æ–‡å­—

**è¿”å›æ ¼å¼**ï¼ˆJSON æ•°ç»„ï¼‰ï¼š
[
    {"local_name": "å­¦ç§‘å½“åœ°è¯­è¨€åç§°", "zh_name": "å­¦ç§‘ä¸­æ–‡åç§°"},
    {"local_name": "å¦ä¸€ä¸ªå­¦ç§‘", "zh_name": "å¦ä¸€ä¸ªå­¦ç§‘ä¸­æ–‡"}
]

å¦‚æœåˆ—è¡¨å®Œæ•´ï¼Œè¿”å›ï¼š[]
```

---

### 4.4 æç¤ºè¯ 3: æœç´¢è¯ç”Ÿæˆï¼ˆQuery Generationï¼‰

**æ–‡ä»¶ä½ç½®**: `search_engine_v2.py` (ç¬¬ 402-427 è¡Œ)

**ç”¨é€”**: æ ¹æ®å›½å®¶ã€å¹´çº§ã€å­¦ç§‘ç”Ÿæˆæœ¬åœ°è¯­è¨€çš„æœç´¢è¯

**æ¨¡å‹**: DeepSeek

**å‚æ•°é…ç½®**:
- `temperature`: 0.2
- `max_tokens`: 50
- `tool_choice`: ç¦ç”¨ï¼ˆä¸è®¾ç½® tool_choice å’Œ toolsï¼‰

**è°ƒç”¨æ–¹æ³•**: `client.call_llm()`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æœç´¢è¯ç”Ÿæˆä¸“å®¶ï¼Œä¸“é—¨ä¸ºæ•™è‚²è§†é¢‘èµ„æºç”Ÿæˆé«˜è´¨é‡çš„æœç´¢è¯ã€‚
ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®å›½å®¶ã€å¹´çº§ã€å­¦æœŸã€å­¦ç§‘ä¿¡æ¯ï¼Œç”Ÿæˆä½¿ç”¨{language}è¯­è¨€çš„æœç´¢è¯ã€‚

é‡è¦åŸåˆ™ï¼š
1. ä½¿ç”¨ç›®æ ‡å›½å®¶çš„å®˜æ–¹è¯­è¨€æˆ–å¸¸ç”¨è¯­è¨€ï¼ˆ{language}ï¼‰
2. ä½¿ç”¨è¯¥å›½å®¶æ•™è‚²ç³»ç»Ÿä¸­å¸¸ç”¨çš„æœ¯è¯­
3. ä¼˜å…ˆä½¿ç”¨"playlist"ã€"è¯¾ç¨‹"ã€"æ•™å­¦è§†é¢‘"ç­‰å…³é”®è¯
4. æœç´¢è¯åº”è¯¥ç®€æ´ã€å‡†ç¡®ã€æœ‰æ•ˆï¼ˆé€šå¸¸5-10ä¸ªè¯ï¼‰
5. **åªè¿”å›æœç´¢è¯æœ¬èº«ï¼Œä¸è¦ä»»ä½•è§£é‡Šã€è¯´æ˜æˆ–å…¶ä»–æ–‡å­—**
6. **ä¸è¦ä½¿ç”¨ä¸­æ–‡ï¼Œåªä½¿ç”¨{language}è¯­è¨€**
```

#### User Prompt

```
è¯·ä¸ºä»¥ä¸‹æ•™è‚²è§†é¢‘æœç´¢ç”Ÿæˆæœç´¢è¯ï¼š

å›½å®¶ï¼š{request.country}
å¹´çº§ï¼š{request.grade}
å­¦æœŸï¼š{request.semester or "ä¸æŒ‡å®š"}
å­¦ç§‘ï¼š{request.subject}
è¯­è¨€ï¼š{language}

è¦æ±‚ï¼š
- ä½¿ç”¨{language}è¯­è¨€
- åŒ…å«å­¦ç§‘å’Œå¹´çº§ä¿¡æ¯
- ä¼˜å…ˆåŒ…å«"playlist"æˆ–"è¯¾ç¨‹"ç­‰å…³é”®è¯
- æœç´¢è¯é•¿åº¦ï¼š5-10ä¸ªè¯

**é‡è¦ï¼šåªè¿”å›æœç´¢è¯æœ¬èº«ï¼Œä¸è¦ä»»ä½•å…¶ä»–æ–‡å­—ã€è§£é‡Šæˆ–è¯´æ˜ã€‚**
```

---

### 4.5 æç¤ºè¯ 4: ç»“æœè¯„ä¼°ï¼ˆResult Evaluationï¼‰

**æ–‡ä»¶ä½ç½®**: `search_engine_v2.py` (ç¬¬ 568-583 è¡Œ)

**ç”¨é€”**: å¯¹æœç´¢ç»“æœè¿›è¡Œè¯„åˆ†å’Œæ¨è

**æ¨¡å‹**: DeepSeek

**å‚æ•°é…ç½®**:
- `temperature`: 0.3
- `max_tokens`: 1500
- `tool_choice`: ç¦ç”¨ï¼ˆä¸è®¾ç½® tool_choice å’Œ toolsï¼‰

**è°ƒç”¨æ–¹æ³•**: `client.call_llm()`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªæ•™è‚²å†…å®¹è´¨é‡è¯„ä¼°ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å¯¹æœç´¢ç»“æœè¿›è¡Œè¯„åˆ†å’Œæ¨èã€‚

**è¯„åˆ†æ ‡å‡†ï¼ˆ0-10åˆ†ï¼‰**ï¼š
- 9-10åˆ†ï¼šå†…å®¹é«˜åº¦ç›¸å…³ï¼Œæ¥æºæƒå¨ï¼Œæ ‡é¢˜æ˜ç¡®ï¼Œæ‘˜è¦æ˜¾ç¤ºé«˜è´¨é‡
- 7-8åˆ†ï¼šå†…å®¹ç›¸å…³ï¼Œæ¥æºå¯é ï¼Œæ ‡é¢˜æ¸…æ™°
- 5-6åˆ†ï¼šå†…å®¹éƒ¨åˆ†ç›¸å…³ï¼Œä½†å¯èƒ½ä¸å¤Ÿå®Œæ•´æˆ–æƒå¨
- 3-4åˆ†ï¼šå†…å®¹ç›¸å…³æ€§è¾ƒä½
- 0-2åˆ†ï¼šå†…å®¹ä¸ç›¸å…³æˆ–è´¨é‡å¾ˆä½

**è¾“å‡ºæ ¼å¼**ï¼šè¿”å› JSON æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å« scoreï¼ˆ0-10ï¼‰å’Œ recommendation_reasonï¼ˆæ¨èç†ç”±ï¼Œ50-100å­—ï¼‰
```

#### User Prompt

```
è¯·è¯„ä¼°ä»¥ä¸‹æœç´¢ç»“æœï¼Œé’ˆå¯¹ {country} çš„ {grade} {subject} æ•™å­¦èµ„æºï¼š

{results_context}

è¯·è¿”å› JSON æ•°ç»„æ ¼å¼ï¼Œæ¯ä¸ªç»“æœä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« score å’Œ recommendation_reason å­—æ®µã€‚
```

---

### 4.6 æç¤ºè¯ 5: æœç´¢ç­–ç•¥ç”Ÿæˆï¼ˆSearch Strategy Generationï¼‰

**æ–‡ä»¶ä½ç½®**: `search_strategy_agent.py` (ç¬¬ 95-132 è¡Œ)

**ç”¨é€”**: æ ¹æ®å›½å®¶ã€å¹´çº§ã€ç§‘ç›®åˆ¶å®šä¸ªæ€§åŒ–çš„æœç´¢ç­–ç•¥

**æ¨¡å‹**: Grok-4-Fast

**å‚æ•°é…ç½®**:
- `temperature`: 0.2
- `max_tokens`: 500
- `tool_choice`: ç¦ç”¨ï¼ˆä¸è®¾ç½® tool_choice å’Œ toolsï¼‰

**è°ƒç”¨æ–¹æ³•**: `client.call_llm()`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æœç´¢ç­–ç•¥ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®å›½å®¶ã€å¹´çº§ã€ç§‘ç›®åˆ¶å®šä¸ªæ€§åŒ–çš„æœç´¢ç­–ç•¥ã€‚

**å…³é”®è¦æ±‚**ï¼š
1. åªèƒ½è¿”å›JSONæ ¼å¼ï¼Œä¸èƒ½è¿”å›ä»»ä½•å…¶ä»–æ–‡æœ¬ã€è§£é‡Šã€Markdownæ ¼å¼æˆ–ä»£ç å—æ ‡è®°
2. æ ¹æ®å›½å®¶ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æœç´¢å¹³å°å’Œæœç´¢å¼•æ“
3. å¯¹äºä¸­å›½ï¼Œå¿…é¡»åŒ…å«Bç«™ï¼ˆbilibili.comï¼‰ç­‰ä¸­æ–‡å¹³å°ï¼Œå¹¶ä½¿ç”¨ä¸­æ–‡æœç´¢å¼•æ“
4. å¯¹äºå…¶ä»–å›½å®¶ï¼Œæ ¹æ®å…¶å¸¸ç”¨å¹³å°å’Œè¯­è¨€é€‰æ‹©åˆé€‚çš„ç­–ç•¥

**è¾“å‡ºæ ¼å¼**ï¼š
{
  "search_language": "è¯­è¨€ä»£ç ï¼ˆå¦‚ï¼šzh, en, idï¼‰",
  "use_chinese_search_engine": true/false,
  "platforms": ["å¹³å°åˆ—è¡¨ï¼Œå¦‚ï¼šbilibili.com, youtube.com"],
  "search_queries": ["æœç´¢è¯å˜ä½“1", "æœç´¢è¯å˜ä½“2"],
  "priority_domains": ["ä¼˜å…ˆæœç´¢çš„åŸŸååˆ—è¡¨"],
  "notes": "ç­–ç•¥è¯´æ˜"
}

**é‡è¦**ï¼šç›´æ¥è¿”å›JSONï¼Œä¸è¦æ·»åŠ ä»»ä½•å‰ç¼€æˆ–åç¼€ã€‚
```

#### User Prompt

```
è¯·ä¸ºä»¥ä¸‹æœç´¢è¯·æ±‚åˆ¶å®šæœç´¢ç­–ç•¥ï¼š

å›½å®¶: {country} ({country_name})
è¯­è¨€ä»£ç : {language_code}
å¹´çº§: {grade}
å­¦ç§‘: {subject}
å­¦æœŸ: {semester or 'ä¸æŒ‡å®š'}

ç°æœ‰åŸŸååˆ—è¡¨: {existing_domains}

**è¦æ±‚**ï¼š
1. ç¡®å®šæœç´¢è¯­è¨€ï¼ˆåº”è¯¥ä½¿ç”¨ {language_code}ï¼‰
2. å¦‚æœæ˜¯ä¸­å›½ï¼ˆCNï¼‰ä¸”å­¦ç§‘æ˜¯ä¸­æ–‡å†…å®¹ï¼Œå¿…é¡»è®¾ç½® use_chinese_search_engine=trueï¼Œå¹¶åŒ…å« bilibili.com
3. æ ¹æ®å›½å®¶ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å¹³å°ï¼ˆå¦‚ï¼šä¸­å›½ç”¨Bç«™ï¼Œå°å°¼ç”¨YouTubeå’Œæœ¬åœ°å¹³å°ï¼‰
4. ç”Ÿæˆ2-3ä¸ªæœç´¢è¯å˜ä½“ï¼ˆä½¿ç”¨æœ¬åœ°è¯­è¨€ï¼‰
5. ç¡®å®šä¼˜å…ˆæœç´¢çš„åŸŸåï¼ˆæœ€å¤š5ä¸ªï¼‰

è¯·è¿”å›JSONæ ¼å¼çš„ç­–ç•¥ï¼š
```

---

### 4.7 æç¤ºè¯ 6: çŸ¥è¯†ç‚¹åŒ¹é…ï¼ˆKnowledge Point Matchingï¼‰

**æ–‡ä»¶ä½ç½®**: `core/video_evaluator.py` (ç¬¬ 110-132 è¡Œ)

**ç”¨é€”**: æ ¹æ®è§†é¢‘å†…å®¹ï¼Œä»çŸ¥è¯†ç‚¹åˆ—è¡¨ä¸­é€‰æ‹©æœ€ç›¸å…³çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹

**æ¨¡å‹**: DeepSeek

**å‚æ•°é…ç½®**:
- `temperature`: 0.3
- `max_tokens`: 500
- `tool_choice`: ç¦ç”¨ï¼ˆä¸è®¾ç½® tool_choice å’Œ toolsï¼‰

**è°ƒç”¨æ–¹æ³•**: `client.call_llm()`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªæ•™è‚²å†…å®¹åŒ¹é…ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®è§†é¢‘å†…å®¹ï¼Œä»ç»™å®šçš„çŸ¥è¯†ç‚¹åˆ—è¡¨ä¸­é€‰æ‹©æœ€ç›¸å…³çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚

**åŒ¹é…æ ‡å‡†**ï¼š
1. è§†é¢‘å†…å®¹æ˜¯å¦ç›´æ¥è®²è§£è¯¥çŸ¥è¯†ç‚¹ï¼Ÿ
2. è§†é¢‘æ ‡é¢˜å’Œæè¿°æ˜¯å¦ä¸è¯¥çŸ¥è¯†ç‚¹ç›¸å…³ï¼Ÿ
3. è§†é¢‘å†…å®¹æ˜¯å¦è¦†ç›–äº†è¯¥çŸ¥è¯†ç‚¹çš„å­¦ä¹ ç›®æ ‡ï¼Ÿ

è¯·è¿”å›æœ€åŒ¹é…çš„çŸ¥è¯†ç‚¹IDï¼Œå¦‚æœæ²¡æœ‰æ˜æ˜¾åŒ¹é…çš„ï¼Œè¿”å›nullã€‚
```

#### User Prompt

```
è¯·æ ¹æ®ä»¥ä¸‹è§†é¢‘ä¿¡æ¯ï¼Œä»çŸ¥è¯†ç‚¹åˆ—è¡¨ä¸­é€‰æ‹©æœ€ç›¸å…³çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚

**è§†é¢‘ä¿¡æ¯**ï¼š
{video_info}

**çŸ¥è¯†ç‚¹åˆ—è¡¨**ï¼š
{knowledge_points_summary}

**è¦æ±‚**ï¼š
1. ä»”ç»†åˆ†æè§†é¢‘å†…å®¹ä¸æ¯ä¸ªçŸ¥è¯†ç‚¹çš„ç›¸å…³æ€§
2. é€‰æ‹©æœ€åŒ¹é…çš„çŸ¥è¯†ç‚¹ï¼ˆå¦‚æœéƒ½ä¸åŒ¹é…ï¼Œè¿”å›nullï¼‰
3. åªè¿”å›çŸ¥è¯†ç‚¹çš„IDï¼Œæ ¼å¼ï¼š{"matched_knowledge_point_id": "MAT-3-4-BIL-01"} æˆ– {"matched_knowledge_point_id": null}

è¯·ä»¥JSONæ ¼å¼è¿”å›ï¼š
```

---

### 4.8 æç¤ºè¯ 7: å†…å®¹ç›¸å…³åº¦è¯„ä¼°ï¼ˆContent Relevance Evaluationï¼‰

**æ–‡ä»¶ä½ç½®**: `core/video_evaluator.py` (ç¬¬ 686-711 è¡Œ)

**ç”¨é€”**: è¯„ä¼°è§†é¢‘å†…å®¹ä¸å­¦ä¹ ç›®æ ‡çš„åŒ¹é…åº¦

**æ¨¡å‹**: Grok-4-Fast

**å‚æ•°é…ç½®**:
- `temperature`: 0.1
- `max_tokens`: 300
- `tool_choice`: ç¦ç”¨ï¼ˆä¸è®¾ç½® tool_choice å’Œ toolsï¼‰

**è°ƒç”¨æ–¹æ³•**: `client.call_llm()`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªJSONè¾“å‡ºæœºå™¨ã€‚ä½ çš„å”¯ä¸€ä»»åŠ¡æ˜¯è¿”å›JSONæ ¼å¼çš„è¯„ä¼°ç»“æœã€‚

**ä¸¥æ ¼è§„åˆ™**ï¼š
1. åªèƒ½è¿”å›JSONå¯¹è±¡ï¼Œæ ¼å¼ï¼š{"score": æ•°å­—, "details": "å­—ç¬¦ä¸²"}
2. ç¦æ­¢è¿”å›ä»»ä½•å…¶ä»–æ–‡æœ¬ã€è§£é‡Šã€Markdownã€ä»£ç å—æ ‡è®°
3. ç¦æ­¢åœ¨JSONå‰åæ·»åŠ ä»»ä½•æ–‡å­—
4. å¦‚æœè¿åè§„åˆ™ï¼Œè¾“å‡ºå°†è¢«è§†ä¸ºæ— æ•ˆ

**è¯„ä¼°æ ‡å‡†**ï¼š
1. è§†é¢‘å†…å®¹æ˜¯å¦ç›´æ¥è®²è§£ç›®æ ‡çŸ¥è¯†ç‚¹ï¼Ÿ
2. æ˜¯å¦è¦†ç›–äº†å­¦ä¹ ç›®æ ‡ä¸­æåˆ°çš„æ‰€æœ‰å…³é”®æ¦‚å¿µï¼Ÿ
3. æ˜¯å¦æœ‰æ— å…³å†…å®¹æˆ–åç¦»ä¸»é¢˜ï¼Ÿ
4. å†…å®¹æ·±åº¦æ˜¯å¦é€‚åˆç›®æ ‡å¹´çº§ï¼Ÿ

**è¾“å‡ºæ ¼å¼ç¤ºä¾‹**ï¼š
{"score": 8.5, "details": "è¯„ä¼°ç†ç”±"}
```

#### User Prompt

```
{"score": 8.5, "details": "è¯„ä¼°ç†ç”±"}

è¯„ä¼°è§†é¢‘å†…å®¹ä¸å­¦ä¹ ç›®æ ‡çš„åŒ¹é…åº¦ã€‚

å­¦ä¹ ç›®æ ‡ï¼š{learning_objective}
çŸ¥è¯†ç‚¹ä¸»é¢˜ï¼š{topic_title}
è§†é¢‘å­—å¹•ï¼ˆå‰2000å­—ç¬¦ï¼‰ï¼š{transcript[:2000]}

**é‡è¦**ï¼šåªè¿”å›JSONå¯¹è±¡ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—ã€‚æ ¼å¼ï¼š{"score": æ•°å­—, "details": "å­—ç¬¦ä¸²"}
```

---

### 4.9 æç¤ºè¯ 8: æ•™å­¦è´¨é‡è¯„ä¼°ï¼ˆPedagogy Quality Evaluationï¼‰

**æ–‡ä»¶ä½ç½®**: `core/video_evaluator.py` (ç¬¬ 775-797 è¡Œ)

**ç”¨é€”**: è¯„ä¼°æ•™å­¦è§†é¢‘çš„æ•™å­¦è´¨é‡

**æ¨¡å‹**: Grok-4-Fast

**å‚æ•°é…ç½®**:
- `temperature`: 0.1
- `max_tokens`: 300
- `tool_choice`: ç¦ç”¨ï¼ˆä¸è®¾ç½® tool_choice å’Œ toolsï¼‰

**è°ƒç”¨æ–¹æ³•**: `client.call_llm()`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªJSONè¾“å‡ºæœºå™¨ã€‚ä½ çš„å”¯ä¸€ä»»åŠ¡æ˜¯è¿”å›JSONæ ¼å¼çš„è¯„ä¼°ç»“æœã€‚

**ä¸¥æ ¼è§„åˆ™**ï¼š
1. åªèƒ½è¿”å›JSONå¯¹è±¡ï¼Œæ ¼å¼ï¼š{"score": æ•°å­—, "details": "å­—ç¬¦ä¸²"}
2. ç¦æ­¢è¿”å›ä»»ä½•å…¶ä»–æ–‡æœ¬ã€è§£é‡Šã€Markdownã€ä»£ç å—æ ‡è®°
3. ç¦æ­¢åœ¨JSONå‰åæ·»åŠ ä»»ä½•æ–‡å­—
4. å¦‚æœè¿åè§„åˆ™ï¼Œè¾“å‡ºå°†è¢«è§†ä¸ºæ— æ•ˆ

**è¯„ä¼°ç»´åº¦**ï¼š
1. è®²è§£é€»è¾‘ï¼šæ˜¯å¦æœ‰æ¸…æ™°çš„å¼•å…¥->æ¦‚å¿µ->ä¾‹å­->æ€»ç»“ç»“æ„ï¼Ÿ
2. è¯­é€Ÿï¼šæ˜¯å¦é€‚åˆç›®æ ‡å­¦ç”Ÿï¼Ÿ
3. å¼•å¯¼æ€§æé—®ï¼šæ˜¯å¦æœ‰é€‚å½“çš„æé—®ï¼Ÿ
4. é‡ç‚¹å¼ºè°ƒï¼šæ˜¯å¦çªå‡ºäº†å…³é”®æ¦‚å¿µï¼Ÿ
5. äº’åŠ¨æ€§ï¼šæ˜¯å¦æœ‰é€‚å½“çš„äº’åŠ¨å…ƒç´ ï¼Ÿ

**è¾“å‡ºæ ¼å¼ç¤ºä¾‹**ï¼š
{"score": 7.5, "details": "è¯„ä¼°ç†ç”±"}
```

#### User Prompt

```
{"score": 7.5, "details": "è¯„ä¼°ç†ç”±"}

è¯„ä¼°æ•™å­¦è§†é¢‘çš„æ•™å­¦è´¨é‡ã€‚

è§†é¢‘å­—å¹•ï¼ˆå‰2000å­—ç¬¦ï¼‰ï¼š{transcript[:2000]}

**é‡è¦**ï¼šåªè¿”å›JSONå¯¹è±¡ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—ã€‚æ ¼å¼ï¼š{"score": æ•°å­—, "details": "å­—ç¬¦ä¸²"}
```

---

### 4.10 æç¤ºè¯ 9: è§†è§‰è´¨é‡è¯„ä¼°ï¼ˆVisual Quality Evaluationï¼‰

**æ–‡ä»¶ä½ç½®**: `core/video_evaluator.py` (ç¬¬ 467-494 è¡Œ)

**ç”¨é€”**: è¯„ä¼°æ•™å­¦è§†é¢‘çš„è§†è§‰è®¾è®¡è´¨é‡

**æ¨¡å‹**: gpt-4o (Vision API)

**å‚æ•°é…ç½®**:
- `temperature`: 0.3
- `max_tokens`: 500
- `tool_choice`: ç¦ç”¨ï¼ˆä¸è®¾ç½® tool_choice å’Œ toolsï¼‰

**è°ƒç”¨æ–¹æ³•**: `vision_client.analyze_images()`

#### System Prompt

```
ä½ æ˜¯ä¸€ä¸ªæ•™è‚²è§†é¢‘è´¨é‡è¯„ä¼°ä¸“å®¶ï¼Œä¸“é—¨è¯„ä¼°æ•™å­¦å¯è§†åŒ–çš„è®¾è®¡è´¨é‡ã€‚

**é‡è¦è¯´æ˜**ï¼š
æˆ‘å°†æä¾›è§†é¢‘çš„æˆªå›¾ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›æˆªå›¾æ¥è‡ªä½åˆ†è¾¨ç‡ç‰ˆæœ¬ï¼Œ**è¯·å¿½ç•¥å‹ç¼©å™ªç‚¹å’Œåƒç´ æ¨¡ç³Š**ã€‚
è¯·ä¸“æ³¨äºè¯„ä¼°**æ•™å­¦å¯è§†åŒ–çš„è®¾è®¡è´¨é‡**ï¼š

1. **æ¿ä¹¦/PPTæ’ç‰ˆ**ï¼šæ˜¯å¦æ‹¥æŒ¤ï¼Ÿæ˜¯å¦æ¸…æ™°æ˜“è¯»ï¼Ÿ
2. **å­—ä½“å¤§å°**ï¼šåœ¨ç§»åŠ¨ç«¯æ˜¯å¦æ˜“è¯»ï¼Ÿ
3. **è§†è§‰è¾…åŠ©**ï¼šæ˜¯å¦ä½¿ç”¨äº†å›¾è¡¨ã€åŠ¨ç”»ç­‰è¾…åŠ©ç†è§£ï¼Ÿ
4. **æ•™å¸ˆä½ç½®**ï¼šè€å¸ˆæ˜¯å¦ä¸€ç›´é®æŒ¡æ¿ä¹¦ï¼Ÿ
5. **è‰²å½©å¯¹æ¯”**ï¼šæ–‡å­—ä¸èƒŒæ™¯å¯¹æ¯”åº¦æ˜¯å¦è¶³å¤Ÿï¼Ÿ
6. **å†…å®¹ç»„ç»‡**ï¼šä¿¡æ¯å±‚æ¬¡æ˜¯å¦æ¸…æ™°ï¼Ÿ

è¯·ç»™å‡º0-10åˆ†çš„è¯„åˆ†ï¼Œå¹¶æä¾›ç®€çŸ­çš„è¯„ä¼°ç†ç”±ã€‚
```

#### User Prompt

```
è¯·åˆ†æä»¥ä¸‹æ•™å­¦è§†é¢‘çš„å…³é”®å¸§ï¼ˆå…±{len(frames_paths)}å¼ ï¼‰ï¼Œè¯„ä¼°å…¶æ•™å­¦å¯è§†åŒ–è®¾è®¡è´¨é‡ã€‚

**è¯„ä¼°è¦æ±‚**ï¼š
1. å¿½ç•¥ä½åˆ†è¾¨ç‡é€ æˆçš„åƒç´ æ¨¡ç³Š
2. ä¸“æ³¨äºè¯„ä¼°æ•™å­¦è®¾è®¡çš„è´¨é‡
3. ç»™å‡º0-10åˆ†çš„è¯„åˆ†
4. æä¾›ç®€çŸ­çš„è¯„ä¼°ç†ç”±

è¯·ä»¥JSONæ ¼å¼è¿”å›ï¼š
{
    "score": 7.5,
    "details": "æ¿ä¹¦æ¸…æ™°ï¼Œä½†é…è‰²å•è°ƒï¼Œç¼ºå°‘å›¾è¡¨è¾…åŠ©"
}
```

---

## 5. API æ¥å£æ–‡æ¡£

### 5.1 æœç´¢æ¥å£

**ç«¯ç‚¹**: `POST /api/search`

**è¯·æ±‚ä½“**:
```json
{
  "country": "CN",
  "grade": "åˆäºŒ",
  "subject": "åœ°ç†",
  "semester": null,
  "language": null
}
```

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "query": "åœ°ç† åˆäºŒ æ•™å­¦è§†é¢‘",
  "results": [
    {
      "title": "è§†é¢‘æ ‡é¢˜",
      "url": "https://...",
      "snippet": "è§†é¢‘æ‘˜è¦",
      "score": 8.5,
      "recommendation_reason": "æ¨èç†ç”±",
      "source": "è§„åˆ™-YouTube"
    }
  ],
  "total_count": 20,
  "playlist_count": 5,
  "video_count": 15
}
```

### 5.2 å›½å®¶å‘ç°æ¥å£

**ç«¯ç‚¹**: `POST /api/discover_country`

**è¯·æ±‚ä½“**:
```json
{
  "country_name": "ä¸­å›½"
}
```

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "profile": {
    "country_code": "CN",
    "country_name": "China",
    "country_name_zh": "ä¸­å›½",
    "language_code": "zh",
    "grades": [...],
    "subjects": [...],
    "domains": [...]
  }
}
```

### 5.3 è§†é¢‘è¯„ä¼°æ¥å£

**ç«¯ç‚¹**: `POST /api/analyze_video`

**è¯·æ±‚ä½“**:
```json
{
  "video_url": "https://www.youtube.com/watch?v=...",
  "output_dir": "./data/videos/analyzed",
  "knowledge_point": null,
  "search_params": {
    "country": "ID",
    "grade": "Kelas 2",
    "subject": "Matematika"
  }
}
```

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "evaluation": {
    "overall_score": 7.3,
    "visual_quality": {...},
    "relevance": {...},
    "pedagogy": {...},
    "metadata": {...}
  },
  "matched_knowledge_point": {...},
  "video_metadata": {...}
}
```

---

## 6. æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 6.1 SearchEngineV2

**æ–‡ä»¶**: `search_engine_v2.py`

**èŒè´£**:
- æ‰§è¡Œæ··åˆæœç´¢ï¼ˆé€šç”¨æœç´¢ + æœ¬åœ°å®šå‘æœç´¢ï¼‰
- è°ƒç”¨æœç´¢ç­–ç•¥Agentåˆ¶å®šç­–ç•¥
- è°ƒç”¨æŸ¥è¯¢ç”Ÿæˆå™¨ç”Ÿæˆæœç´¢è¯
- è°ƒç”¨ç»“æœè¯„ä¼°å™¨è¯„ä¼°æœç´¢ç»“æœ

### 6.2 SearchStrategyAgent

**æ–‡ä»¶**: `search_strategy_agent.py`

**èŒè´£**:
- æ ¹æ®å›½å®¶ã€å¹´çº§ã€ç§‘ç›®åˆ¶å®šä¸ªæ€§åŒ–æœç´¢ç­–ç•¥
- ç¡®å®šæœç´¢è¯­è¨€å’Œæœç´¢å¼•æ“ç±»å‹
- æ¨èåˆé€‚çš„å¹³å°å’ŒåŸŸå
- ç”Ÿæˆæœç´¢è¯å˜ä½“

### 6.3 CountryDiscoveryAgent

**æ–‡ä»¶**: `discovery_agent.py`

**èŒè´£**:
- æœç´¢å›½å®¶æ•™è‚²ä½“ç³»ä¿¡æ¯
- æå–ç»“æ„åŒ–ä¿¡æ¯ï¼ˆå¹´çº§ã€å­¦ç§‘ã€åŸŸåï¼‰
- å­¦ç§‘äº¤å‰éªŒè¯å’Œè¡¥å……

### 6.4 VideoEvaluator

**æ–‡ä»¶**: `core/video_evaluator.py`

**èŒè´£**:
- åŒ¹é…è§†é¢‘åˆ°çŸ¥è¯†ç‚¹
- è¯„ä¼°è§†è§‰è´¨é‡ï¼ˆä½¿ç”¨Vision APIï¼‰
- è¯„ä¼°å†…å®¹ç›¸å…³åº¦
- è¯„ä¼°æ•™å­¦è´¨é‡
- è¯„ä¼°çƒ­åº¦/å…ƒæ•°æ®

---

## 7. æ•°æ®æ¨¡å‹

### 7.1 SearchRequest

```python
class SearchRequest(BaseModel):
    country: str
    grade: str
    semester: Optional[str] = None
    subject: str
    language: Optional[str] = None
```

### 7.2 SearchResult

```python
class SearchResult(BaseModel):
    title: str
    url: str
    snippet: str = ""
    source: str = "è§„åˆ™"
    score: float = 0.0
    recommendation_reason: str = ""
    is_selected: bool = False
    evaluation_status: Optional[str] = None
    evaluation_result: Optional[Dict[str, Any]] = None
```

### 7.3 SearchStrategy

```python
class SearchStrategy(BaseModel):
    search_language: str
    use_chinese_search_engine: bool = False
    platforms: List[str] = []
    search_queries: List[str] = []
    priority_domains: List[str] = []
    notes: str = ""
```

---

## 8. ä½¿ç”¨æµç¨‹

### 8.1 æœç´¢æµç¨‹

1. ç”¨æˆ·é€‰æ‹©å›½å®¶ã€å¹´çº§ã€å­¦ç§‘
2. ç³»ç»Ÿè°ƒç”¨æœç´¢ç­–ç•¥Agentåˆ¶å®šç­–ç•¥
3. ç³»ç»Ÿç”Ÿæˆæœç´¢è¯
4. æ‰§è¡Œé€šç”¨æœç´¢å’Œæœ¬åœ°å®šå‘æœç´¢
5. åˆå¹¶å»é‡
6. è§„åˆ™ç­›é€‰
7. LLMè¯„åˆ†
8. è¿”å›ç»“æœ

### 8.2 è§†é¢‘è¯„ä¼°æµç¨‹

1. ç”¨æˆ·ç‚¹å‡»"AI æ·±åº¦è¯„ä¼°"
2. ç³»ç»Ÿä¸‹è½½è§†é¢‘ï¼ˆ480pï¼‰
3. æå–å…ƒæ•°æ®ã€å…³é”®å¸§ã€éŸ³é¢‘
4. æå–å­—å¹•ï¼ˆä¼˜å…ˆå®˜æ–¹å­—å¹•ï¼Œå¦åˆ™Whisperè½¬å½•ï¼‰
5. åŒ¹é…çŸ¥è¯†ç‚¹
6. å¤šç»´åº¦è¯„ä¼°ï¼ˆè§†è§‰ã€ç›¸å…³åº¦ã€æ•™å­¦ã€çƒ­åº¦ï¼‰
7. è®¡ç®—æ€»åˆ†
8. ä¿å­˜è¯„ä¼°ç»“æœ
9. è¿”å›è¯„ä¼°ç»“æœ

---

## 9. é”™è¯¯å¤„ç†ä¸ä¼˜åŒ–

### 9.1 JSONè§£æå®¹é”™

- ä½¿ç”¨ `json_utils.py` ä¸­çš„å·¥å…·å‡½æ•°
- å¤šå±‚å®¹é”™æœºåˆ¶ï¼ˆç›´æ¥è§£æ â†’ ast.literal_eval â†’ æ­£åˆ™æå–ï¼‰

### 9.2 LLMè¾“å‡ºè§„èŒƒåŒ–

- å¼ºåŒ–Promptè¦æ±‚åªè¿”å›JSON
- é™ä½temperatureæé«˜ç¡®å®šæ€§
- å‡å°‘max_tokenså¼ºåˆ¶ç®€æ´

### 9.3 è§†é¢‘å»é‡

- æ¯ä¸ªè§†é¢‘URLåœ¨æ•´ä¸ªé¡µé¢ä¸­åªæ˜¾ç¤ºä¸€æ¬¡
- ä¿ç•™æœ€æ–°çš„ä¸€æ¡è¯„ä»·è®°å½•

---

## 10. éƒ¨ç½²ä¸é…ç½®

### 10.1 ç¯å¢ƒå˜é‡

```bash
AI_BUILDER_TOKEN=your_token_here
```

### 10.2 ä¾èµ–å®‰è£…

```bash
pip install flask pydantic requests pandas openpyxl yt-dlp ffmpeg-python openai-whisper
```

### 10.3 å¯åŠ¨æœåŠ¡

```bash
python3 web_app.py
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: V3.2.0  
**æœ€åæ›´æ–°**: 2025-12-30  
**çŠ¶æ€**: âœ… å®Œæ•´





