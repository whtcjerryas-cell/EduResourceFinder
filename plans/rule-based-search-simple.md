# feat: åŸºäºè§„åˆ™çš„å¤šå›½æ•™è‚²èµ„æºæœç´¢ç³»ç»Ÿ

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

å»ºç«‹ä¸€ä¸ª**ç®€å•ã€å¯é ã€é›¶ç»´æŠ¤**çš„å¤šå›½æ•™è‚²èµ„æºæœç´¢ç³»ç»Ÿï¼Œæ”¯æŒ10ä¸ªä¸»è¦å›½å®¶ï¼Œä½¿ç”¨è§„åˆ™é…ç½®ä»£æ›¿AIã€‚

### å…³é”®ç‰¹æ€§

- âœ… **ç®€æ´æ€§**ï¼š150è¡Œä»£ç ï¼ˆvs AIæ–¹æ¡ˆçš„800-1200è¡Œï¼‰
- âœ… **å¯é æ€§**ï¼š100%å¯é¢„æµ‹ï¼Œæ— LLMå¹»è§‰
- âœ… **é›¶æˆæœ¬**ï¼š$0è¿è¡Œæˆæœ¬ï¼ˆvs AIæ–¹æ¡ˆ$200-2,000/å¹´ï¼‰
- âœ… **å¿«é€Ÿå®æ–½**ï¼š2-3å¤©ï¼ˆvs AIæ–¹æ¡ˆ4-6å‘¨ï¼‰
- âœ… **æ˜“äºç»´æŠ¤**ï¼šæ·»åŠ æ–°å›½å®¶=10åˆ†é’Ÿé…ç½®

### æ”¯æŒçš„å›½å®¶ï¼ˆ10ä¸ªï¼‰

åŸºäºå…¨çƒæ•™è‚²èµ„æºéœ€æ±‚åˆ†æï¼š

**äºšæ´²ï¼ˆ5ä¸ªï¼‰**ï¼š
1. å°åº¦å°¼è¥¿äºš (ID) - å·²æœ‰éœ€æ±‚
2. è²å¾‹å®¾ (PH) - è‹±è¯­æ•™è‚²å¤§å›½
3. è¶Šå— (VN) - å¿«é€Ÿå¢é•¿
4. æ³°å›½ (TH) - æ•™è‚²æŠ•å…¥å¤§
5. å°åº¦ (IN) - å·¨å¤§å¸‚åœº

**ä¸­ä¸œï¼ˆ2ä¸ªï¼‰**ï¼š
6. æ²™ç‰¹é˜¿æ‹‰ä¼¯ (SA) - ä½ æåˆ°çš„éœ€æ±‚
7. é˜¿è”é…‹ (UAE) - æ•™è‚²ä¸­å¿ƒ

**è‹±è¯­å›½å®¶ï¼ˆ2ä¸ªï¼‰**ï¼š
8. ç¾å›½ (US) - å…¨çƒå‚è€ƒ
9. è‹±å›½ (GB) - ä¼ ç»Ÿæ•™è‚²å¼ºå›½

**å…¶ä»–ï¼ˆ1ä¸ªï¼‰**ï¼š
10. ä¸­å›½ (CN) - å¦‚å¯è®¿é—®

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ·æœç´¢è¯·æ±‚                      â”‚
â”‚     country=ID, grade=1, subject=math   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      RuleBasedQueryGenerator             â”‚
â”‚    ä»é…ç½®æ–‡ä»¶è¯»å–æŸ¥è¯¢æ¨¡æ¿ï¼ˆ<0.1ç§’ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”œâ”€â†’ "Matematika SD Kelas 1 Kurikulum Merdeka"
                 â”œâ”€â†’ "Ruangguru Matematika Kelas 1 SD"
                 â””â”€â†’ "belajar matematika kelas 1 sd"
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      MultiSearchEngine                   â”‚
â”‚      è°ƒç”¨æœç´¢å¼•æ“ï¼ˆ5-10ç§’ï¼‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      DomainBasedScorer                   â”‚
â”‚   æ ¹æ®åŸŸåç™½åå•è¯„åˆ†ï¼ˆ<0.1ç§’ï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      è¿”å›æ’åºåçš„ç»“æœ                      â”‚
â”‚  Ruangguru(9.5åˆ†) > YouTube(7.0åˆ†)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä¼˜åŠ¿

| ç»´åº¦ | è§„åˆ™æ–¹æ¡ˆ | AIæ–¹æ¡ˆ |
|------|---------|--------|
| ä»£ç é‡ | 150è¡Œ | 800-1200è¡Œ |
| å®æ–½æ—¶é—´ | 2-3å¤© | 4-6å‘¨ |
| è¿è¡Œæˆæœ¬ | $0 | $200-2,000/å¹´ |
| å¯é æ€§ | 100% | 70% |
| å“åº”æ—¶é—´ | 5-10ç§’ | 20-120ç§’ |
| å¯ç»´æŠ¤æ€§ | é«˜ï¼ˆé…ç½®æ–‡ä»¶ï¼‰| ä½ï¼ˆpromptè°ƒè¯•ï¼‰|

---

## ğŸ“ å®Œæ•´å®ç°

### æ–‡ä»¶1ï¼š`config/country_search_config.yaml`

**å›½å®¶é…ç½®æ–‡ä»¶**ï¼ˆ10ä¸ªå›½å®¶çš„å®Œæ•´é…ç½®ï¼‰

```yaml
# ============================================
# å¤šå›½æ•™è‚²èµ„æºæœç´¢é…ç½®
# ============================================
# æ·»åŠ æ–°å›½å®¶ï¼šåœ¨å¯¹åº”åŒºåŸŸæ·»åŠ é…ç½®å³å¯
# ============================================

# ============================================
# äºšæ´²å›½å®¶ (Asia)
# ============================================

ID:  # å°åº¦å°¼è¥¿äºš Indonesia
  grade_1:
    math:
      # æœ¬åœ°åŒ–æœ¯è¯­
      localized_terms:
        grade: "SD Kelas 1"  # Sekolah Dasar = å°å­¦
        subject: "Matematika"
        curriculum: "Kurikulum Merdeka"

      # æœç´¢æŸ¥è¯¢æ¨¡æ¿ï¼ˆæ”¯æŒå˜é‡ï¼š{grade}, {subject}, {curriculum}ï¼‰
      queries:
        - "{subject} {grade} {curriculum}"
        - "{subject} {grade} SD"
        - "belajar {subject} {grade}"
        - "{subject} SD Kelas 1 playlist"
        - "Ruangguru {subject} Kelas 1"

      # åŸŸåç™½åå•è¯„åˆ†ï¼ˆ9.5=æœ€é«˜ï¼Œ5.0=é»˜è®¤ï¼‰
      trusted_domains:
        "ruangguru.com": 9.5
        "youtube.com": 7.5
        "zenius.net": 8.5
        "kemdikbud.go.id": 9.0

PH:  # è²å¾‹å®¾ Philippines
  grade_1:
    math:
      localized_terms:
        grade: "Grade 1"
        subject: "Mathematics"
        curriculum: "K to 12"

      queries:
        - "Grade 1 {subject} Philippines"
        - "{subject} Grade 1 {curriculum}"
        - "Grade 1 Math lessons Philippines"
        - "DepEd Grade 1 Mathematics"

      trusted_domains:
        "youtube.com": 7.5
        "khanacademy.org": 8.5
        "ph DepEd": 9.0

VN:  # è¶Šå— Vietnam
  grade_1:
    math:
      localized_terms:
        grade: "Lá»›p 1"
        subject: "ToÃ¡n"
        curriculum: "ChÆ°Æ¡ng trÃ¬nh GDPT 2018"

      queries:
        - "ToÃ¡n {grade} tiá»ƒu há»c"
        - "Há»c ToÃ¡n {grade}"
        - "ToÃ¡n Lá»›p 1 hay"
        - "BÃ i giáº£ng ToÃ¡n {grade}"

      trusted_domains:
        "youtube.com": 7.5
        "vndoc.com": 8.0
        "loigiaihay.com": 7.5

TH:  # æ³°å›½ Thailand
  grade_1:
    math:
      localized_terms:
        grade: "à¸›.1"
        subject: "à¸„à¸“à¸´à¸•à¸¨à¸²à¸ªà¸•à¸£à¹Œ"
        curriculum: "à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£à¸›à¸à¸¡à¸¨à¸¶à¸à¸©à¸²"

      queries:
        - "à¸„à¸“à¸´à¸•à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸›.1"
        - "à¹€à¸£à¸µà¸¢à¸™à¸„à¸“à¸´à¸•à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸›à¸£à¸°à¸–à¸¡à¸¨à¸¶à¸à¸©à¸²à¸›à¸µà¸—à¸µà¹ˆ 1"
        - "à¸šà¸—à¹€à¸£à¸µà¸¢à¸™à¸„à¸“à¸´à¸•à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸›.1"
        - "à¸ªà¸­à¸™à¸„à¸“à¸´à¸•à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸›.1"

      trusted_domains:
        "youtube.com": 7.5
        "khanthai.com": 8.0
        "scholathai.com": 8.5

IN:  # å°åº¦ India
  grade_1:
    math:
      localized_terms:
        grade: "Class 1"
        subject: "Mathematics"
        curriculum: "NCERT"

      queries:
        - "Class 1 {subject} NCERT"
        - "Grade 1 Maths India"
        - "CBSE Class 1 Mathematics"
        - "Maths Class 1 Hindi"

      trusted_domains:
        "youtube.com": 7.5
        "khanacademy.org": 8.5
        "byjus.com": 9.0
        "ncert.nic.in": 9.5

# ============================================
# ä¸­ä¸œå›½å®¶ (Middle East)
# ============================================

SA:  # æ²™ç‰¹é˜¿æ‹‰ä¼¯ Saudi Arabia
  grade_1:
    math:
      localized_terms:
        grade: "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„"
        subject: "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª"
        curriculum: "Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ"

      queries:
        - "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„"
        - "ØªØ¹Ù„Ù… Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„"
        - "Ø¯Ø±ÙˆØ³ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"
        - "Ø­Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„"

      trusted_domains:
        "youtube.com": 7.5
        "edu.sa": 9.5  # æ²™ç‰¹æ•™è‚²éƒ¨
        "msk.sa": 8.5
        "tnou.gov.sa": 8.0

UAE:  # é˜¿è”é…‹ United Arab Emirates
  grade_1:
    math:
      localized_terms:
        grade: "Grade 1"
        subject: "Mathematics"
        curriculum: "Ministry of Education"

      queries:
        - "Grade 1 Maths UAE"
        - "Ministry of Education Grade 1 Math"
        - "Mathematics Grade 1 curriculum UAE"

      trusted_domains:
        "youtube.com": 7.5
        "khanacademy.org": 8.5
        "moe.gov.ae": 9.5

# ============================================
# è‹±è¯­å›½å®¶ (English-speaking)
# ============================================

US:  # ç¾å›½ United States
  grade_1:
    math:
      localized_terms:
        grade: "Grade 1"
        subject: "Mathematics"
        curriculum: "Common Core"

      queries:
        - "Grade 1 {subject} Common Core"
        - "first grade math lessons"
        - "Grade 1 math worksheets"
        - "Eureka Math Grade 1"

      trusted_domains:
        "youtube.com": 7.5
        "khanacademy.org": 9.0
        "greatschools.org": 8.0
        "engageny.org": 8.5

GB:  # è‹±å›½ United Kingdom
  grade_1:
    math:
      localized_terms:
        grade: "Year 1"
        subject: "Mathematics"
        curriculum: "National Curriculum"

      queries:
        - "Year 1 Maths UK"
        - "Key Stage 1 Maths"
        - "Primary Maths Year 1"
        - "Year 1 numeracy"

      trusted_domains:
        "youtube.com": 7.5
        "khanacademy.org": 8.5
        "bbc.co.uk": 9.5  # BBC Bitesize
        "ncetm.org.uk": 8.5

# ============================================
# å…¶ä»–å›½å®¶ (Others)
# ============================================

CN:  # ä¸­å›½ China
  grade_1:
    math:
      localized_terms:
        grade: "ä¸€å¹´çº§"
        subject: "æ•°å­¦"
        curriculum: "ä¹‰åŠ¡æ•™è‚²è¯¾ç¨‹æ ‡å‡†"

      queries:
        - "å°å­¦ä¸€å¹´çº§æ•°å­¦"
        - "ä¸€å¹´çº§æ•°å­¦è¯¾ç¨‹"
        - "å°å­¦æ•°å­¦ä¸€å¹´çº§ä¸Šå†Œ"
        - "ä¸€å¹´çº§æ•°å­¦æ•™å­¦è§†é¢‘"

      trusted_domains:
        "bilibili.com": 8.5
        "iqiyi.com": 7.5
        "youku.com": 7.0
        "edu.cn": 9.0  # ä¸­å›½æ•™è‚²æœºæ„

# ============================================
# é€šç”¨é…ç½®ï¼ˆæœªé…ç½®çš„å›½å®¶ä½¿ç”¨æ­¤é»˜è®¤é…ç½®ï¼‰
# ============================================

DEFAULT:
  grade_1:
    math:
      localized_terms:
        grade: "Grade 1"
        subject: "Mathematics"
        curriculum: "National Curriculum"

      queries:
        - "Grade 1 {subject}"
        - "first grade {subject}"
        - "primary school grade 1 {subject}"

      trusted_domains:
        "youtube.com": 7.5
        "khanacademy.org": 8.5
```

---

### æ–‡ä»¶2ï¼š`core/rule_based_search.py`

**æ ¸å¿ƒæœç´¢å¼•æ“**ï¼ˆ150è¡Œï¼Œç”Ÿäº§å°±ç»ªï¼‰

```python
"""
åŸºäºè§„åˆ™çš„å¤šå›½æ•™è‚²èµ„æºæœç´¢å¼•æ“

ç®€å•ã€å¯é ã€é›¶ç»´æŠ¤
"""

import yaml
from typing import Dict, List, Optional
from pathlib import Path
from search_engine_v2 import MultiSearchEngine

class RuleBasedSearchEngine:
    """åŸºäºè§„åˆ™çš„æ•™è‚²æœç´¢å¼•æ“"""

    def __init__(self, config_path: str = "config/country_search_config.yaml"):
        """åˆå§‹åŒ–æœç´¢å¼•æ“

        Args:
            config_path: é…ç½®æ–‡ä»¶è·¯å¾„
        """
        self.config_path = Path(config_path)
        self.config = self._load_config()
        self.search_engine = MultiSearchEngine()

        print(f"âœ… è§„åˆ™æœç´¢å¼•æ“åˆå§‹åŒ–æˆåŠŸ")
        print(f"   é…ç½®æ–‡ä»¶: {config_path}")
        print(f"   æ”¯æŒå›½å®¶: {list(self.config.keys())}")

    def _load_config(self) -> Dict:
        """åŠ è½½é…ç½®æ–‡ä»¶"""
        try:
            with open(self.config_path, 'r', encoding='utf-8') as f:
                config = yaml.safe_load(f)
            return config
        except FileNotFoundError:
            print(f"âš ï¸ é…ç½®æ–‡ä»¶æœªæ‰¾åˆ°: {self.config_path}")
            return {}
        except yaml.YAMLError as e:
            print(f"âŒ é…ç½®æ–‡ä»¶è§£æå¤±è´¥: {e}")
            return {}

    def search(
        self,
        country: str,
        grade: str,
        subject: str,
        max_results: int = 20
    ) -> Dict:
        """æ‰§è¡Œæœç´¢

        Args:
            country: å›½å®¶ä»£ç ï¼ˆID, SA, CN, USç­‰ï¼‰
            grade: å¹´çº§ï¼ˆ1, 2, 3... æˆ– Grade 1, ä¸€å¹´çº§ï¼‰
            subject: å­¦ç§‘ï¼ˆmath, æ•°å­¦, Mathematicsç­‰ï¼‰
            max_results: è¿”å›ç»“æœæ•°

        Returns:
            {
                'results': [...],
                'localized_info': {...},
                'search_metadata': {...}
            }
        """

        print(f"\nğŸ” è§„åˆ™æœç´¢: {country} - {grade} - {subject}")

        # æ­¥éª¤1ï¼šè·å–é…ç½®
        country_config = self._get_country_config(country)
        if not country_config:
            return self._empty_result(f"æœªé…ç½®å›½å®¶: {country}")

        # æ ‡å‡†åŒ–å¹´çº§å’Œå­¦ç§‘
        normalized_grade = self._normalize_grade(grade, country)
        normalized_subject = self._normalize_subject(subject, country)

        grade_subject_config = country_config.get(
            f"grade_{normalized_grade}", {}
        ).get(normalized_subject, {})

        if not grade_subject_config:
            return self._empty_result(
                f"æœªé…ç½®: {country} - {grade} - {subject}"
            )

        # æ­¥éª¤2ï¼šç”ŸæˆæŸ¥è¯¢
        queries = self._generate_queries(
            grade_subject_config.get('queries', []),
            normalized_grade,
            normalized_subject
        )

        print(f"  ğŸ“ ç”Ÿæˆ{len(queries)}ä¸ªæŸ¥è¯¢:")
        for q in queries[:3]:  # åªæ˜¾ç¤ºå‰3ä¸ª
            print(f"     - {q}")
        if len(queries) > 3:
            print(f"     ... è¿˜æœ‰{len(queries)-3}ä¸ªæŸ¥è¯¢")

        # æ­¥éª¤3ï¼šæ‰§è¡Œæœç´¢
        print(f"\n  ğŸŒ å¹¶è¡Œæœç´¢...")
        all_results = []

        for query in queries:
            try:
                results = self.search_engine.search(query, country=country)
                all_results.extend(results)
                print(f"     âœ… '{query[:40]}...' â†’ {len(results)}ä¸ªç»“æœ")
            except Exception as e:
                print(f"     âš ï¸ '{query[:40]}...' â†’ å¤±è´¥: {e}")

        # å»é‡
        all_results = self._deduplicate_results(all_results)
        print(f"  ğŸ“Š å»é‡å: {len(all_results)}ä¸ªç»“æœ")

        # æ­¥éª¤4ï¼šè¯„åˆ†
        print(f"\n  â­ è¯„åˆ†...")
        scored_results = self._score_results(
            all_results,
            grade_subject_config.get('trusted_domains', {})
        )

        # æ’åºå¹¶è¿”å›å‰Nä¸ª
        final_results = scored_results[:max_results]

        print(f"  âœ… è¿”å›{len(final_results)}ä¸ªç»“æœ")
        if final_results:
            print(f"     æœ€é«˜åˆ†: {final_results[0]['score']:.1f}")
            print(f"     æœ€ä½åˆ†: {final_results[-1]['score']:.1f}")

        # è¿”å›å®Œæ•´ç»“æœ
        return {
            'results': final_results,
            'localized_info': {
                'country': country,
                'grade': grade_subject_config.get('localized_terms', {}).get('grade', grade),
                'subject': grade_subject_config.get('localized_terms', {}).get('subject', subject),
                'curriculum': grade_subject_config.get('localized_terms', {}).get('curriculum', 'N/A'),
                'supported': True
            },
            'search_metadata': {
                'queries_used': queries,
                'total_found': len(all_results),
                'top_score': final_results[0]['score'] if final_results else 0,
                'search_method': 'rule_based'
            }
        }

    def _get_country_config(self, country: str) -> Dict:
        """è·å–å›½å®¶é…ç½®"""
        # é¦–å…ˆå°è¯•ç›´æ¥è·å–
        if country in self.config:
            return self.config[country]

        # å°è¯•å¤§å†™
        country_upper = country.upper()
        if country_upper in self.config:
            return self.config[country_upper]

        # ä½¿ç”¨DEFAULTé…ç½®
        if 'DEFAULT' in self.config:
            print(f"  âš ï¸ å›½å®¶ {country} æœªé…ç½®ï¼Œä½¿ç”¨DEFAULTé…ç½®")
            return self.config['DEFAULT']

        return {}

    def _normalize_grade(self, grade: str, country: str) -> str:
        """æ ‡å‡†åŒ–å¹´çº§"""
        # ç§»é™¤ç©ºæ ¼
        grade = grade.strip().lower()

        # æ˜ å°„åˆ°é…ç½®æ ¼å¼
        grade_map = {
            '1': '1', 'grade 1': '1', 'grade1': '1',
            'ä¸€å¹´çº§': '1', 'å°å­¦ä¸€å¹´çº§': '1',
            'kelas 1': '1', 'sd kelas 1': '1',
            'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„': '1', 'class 1': '1',
            'year 1': '1',
        }

        return grade_map.get(grade, grade)

    def _normalize_subject(self, subject: str, country: str) -> str:
        """æ ‡å‡†åŒ–å­¦ç§‘"""
        # ç§»é™¤ç©ºæ ¼
        subject = subject.strip().lower()

        # æ˜ å°„åˆ°é…ç½®æ ¼å¼
        subject_map = {
            'math': 'math', 'mathematics': 'math',
            'æ•°å­¦': 'math', 'matematika': 'math',
            'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª': 'math',
        }

        return subject_map.get(subject, subject)

    def _generate_queries(
        self,
        query_templates: List[str],
        grade: str,
        subject: str
    ) -> List[str]:
        """ç”ŸæˆæŸ¥è¯¢åˆ—è¡¨"""
        queries = []

        for template in query_templates:
            # æ›¿æ¢å˜é‡
            query = template.format(
                grade=grade,
                subject=subject.title(),
                curriculum="Kurikulum Merdeka"  # å¯ä»¥ä»é…ç½®è¯»å–
            )
            queries.append(query)

        return queries

    def _score_results(
        self,
        results: List[Dict],
        trusted_domains: Dict[str, float]
    ) -> List[Dict]:
        """æ ¹æ®åŸŸåè¯„åˆ†"""
        scored_results = []

        for result in results:
            url = result.get('url', '').lower()

            # é»˜è®¤åˆ†æ•°
            score = 5.0
            score_reason = "Default score"

            # æ£€æŸ¥åŸŸå
            for domain, domain_score in trusted_domains.items():
                if domain in url:
                    score = domain_score
                    score_reason = f"Trusted domain: {domain}"
                    break

            result['score'] = score
            result['score_reason'] = score_reason
            scored_results.append(result)

        # æŒ‰åˆ†æ•°é™åºæ’åº
        scored_results.sort(key=lambda x: x['score'], reverse=True)

        return scored_results

    def _deduplicate_results(self, results: List[Dict]) -> List[Dict]:
        """å»é‡ï¼ˆåŸºäºURLï¼‰"""
        seen_urls = set()
        unique_results = []

        for result in results:
            url = result.get('url', '')
            if url and url not in seen_urls:
                seen_urls.add(url)
                unique_results.append(result)

        return unique_results

    def _empty_result(self, message: str) -> Dict:
        """è¿”å›ç©ºç»“æœ"""
        return {
            'results': [],
            'localized_info': {
                'supported': False,
                'error': message
            },
            'search_metadata': {
                'queries_used': [],
                'total_found': 0,
                'top_score': 0,
                'search_method': 'rule_based'
            }
        }


# ============================================
# ä½¿ç”¨ç¤ºä¾‹
# ============================================

if __name__ == "__main__":
    # åˆå§‹åŒ–æœç´¢å¼•æ“
    engine = RuleBasedSearchEngine()

    # æµ‹è¯•å°å°¼æœç´¢
    print("\n" + "="*70)
    print("æµ‹è¯•ï¼šå°å°¼ä¸€å¹´çº§æ•°å­¦")
    print("="*70)

    result = engine.search(
        country='ID',
        grade='1',
        subject='math',
        max_results=10
    )

    print("\næœç´¢ç»“æœ:")
    for i, r in enumerate(result['results'][:5], 1):
        print(f"{i}. [{r['score']:.1f}åˆ†] {r.get('title', 'N/A')}")
        print(f"   {r.get('url', 'N/A')}")
```

---

### æ–‡ä»¶3ï¼š`tests/test_rule_based_search.py`

**æµ‹è¯•å¥—ä»¶**

```python
"""
æµ‹è¯•è§„åˆ™æœç´¢å¼•æ“
"""

import pytest
from core.rule_based_search import RuleBasedSearchEngine

class TestRuleBasedSearchEngine:
    """æµ‹è¯•è§„åˆ™æœç´¢å¼•æ“"""

    @pytest.fixture
    def engine(self):
        """åˆ›å»ºæœç´¢å¼•æ“å®ä¾‹"""
        return RuleBasedSearchEngine()

    def test_indonesia_grade_1_math(self, engine):
        """æµ‹è¯•å°å°¼ä¸€å¹´çº§æ•°å­¦æœç´¢"""
        result = engine.search(
            country='ID',
            grade='1',
            subject='math',
            max_results=10
        )

        # éªŒè¯
        assert result['localized_info']['supported'] == True
        assert result['localized_info']['grade'] == 'SD Kelas 1'
        assert result['localized_info']['subject'] == 'Matematika'
        assert len(result['results']) > 0
        assert result['results'][0]['score'] >= 7.0  # è‡³å°‘æ˜¯ä¸­ç­‰è´¨é‡

    def test_saudi_arabia_grade_1_math(self, engine):
        """æµ‹è¯•æ²™ç‰¹ä¸€å¹´çº§æ•°å­¦æœç´¢"""
        result = engine.search(
            country='SA',
            grade='1',
            subject='math'
        )

        # éªŒè¯
        assert result['localized_info']['supported'] == True
        assert result['localized_info']['grade'] == 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„'
        assert result['localized_info']['subject'] == 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª'

    def test_unsupported_country(self, engine):
        """æµ‹è¯•ä¸æ”¯æŒçš„å›½å®¶"""
        result = engine.search(
            country='ZZ',  # ä¸å­˜åœ¨çš„å›½å®¶
            grade='1',
            subject='math'
        )

        # åº”è¯¥ä½¿ç”¨DEFAULTé…ç½®
        assert result['localized_info']['supported'] == False

    def test_grade_normalization(self, engine):
        """æµ‹è¯•å¹´çº§æ ‡å‡†åŒ–"""
        # æµ‹è¯•ä¸åŒçš„å¹´çº§è¡¨è¾¾æ–¹å¼
        grades = ['1', 'Grade 1', 'ä¸€å¹´çº§', 'Kelas 1']

        for grade in grades:
            normalized = engine._normalize_grade(grade, 'ID')
            assert normalized == '1'

    def test_subject_normalization(self, engine):
        """æµ‹è¯•å­¦ç§‘æ ‡å‡†åŒ–"""
        # æµ‹è¯•ä¸åŒçš„å­¦ç§‘è¡¨è¾¾æ–¹å¼
        subjects = ['math', 'Mathematics', 'æ•°å­¦', 'Matematika']

        for subject in subjects:
            normalized = engine._normalize_subject(subject, 'ID')
            assert normalized == 'math'

    def test_query_generation(self, engine):
        """æµ‹è¯•æŸ¥è¯¢ç”Ÿæˆ"""
        templates = [
            "{subject} {grade}",
            "{subject} {grade} {curriculum}"
        ]

        queries = engine._generate_queries(templates, 'SD Kelas 1', 'Matematika')

        assert len(queries) == 2
        assert 'Matematika SD Kelas 1' in queries[0]

    def test_deduplication(self, engine):
        """æµ‹è¯•å»é‡"""
        results = [
            {'url': 'https://example.com/1'},
            {'url': 'https://example.com/1'},  # é‡å¤
            {'url': 'https://example.com/2'},
        ]

        unique = engine._deduplicate_results(results)

        assert len(unique) == 2
        assert unique[0]['url'] == 'https://example.com/1'
        assert unique[1]['url'] == 'https://example.com/2'

    def test_scoring(self, engine):
        """æµ‹è¯•è¯„åˆ†"""
        results = [
            {'url': 'https://ruangguru.com/math1'},
            {'url': 'https://unknown.com/math1'},
        ]

        trusted_domains = {
            'ruangguru.com': 9.5
        }

        scored = engine._score_results(results, trusted_domains)

        assert scored[0]['score'] == 9.5
        assert scored[1]['score'] == 5.0
```

---

## ğŸš€ å®æ–½è®¡åˆ’

### Day 1: æ ¸å¿ƒå¼€å‘

- [ ] åˆ›å»ºé…ç½®æ–‡ä»¶ `config/country_search_config.yaml`
  - æ·»åŠ å°å°¼é…ç½®ï¼ˆæµ‹è¯•ï¼‰
  - æ·»åŠ æ²™ç‰¹é…ç½®ï¼ˆéªŒè¯ï¼‰
  - æ·»åŠ DEFAULTé…ç½®

- [ ] å®ç° `RuleBasedSearchEngine` ç±»
  - é…ç½®åŠ è½½
  - æŸ¥è¯¢ç”Ÿæˆ
  - ç»“æœè¯„åˆ†
  - å»é‡é€»è¾‘

### Day 2: æµ‹è¯•å’Œæ‰©å±•

- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
  - æµ‹è¯•å°å°¼æœç´¢
  - æµ‹è¯•æ²™ç‰¹æœç´¢
  - æµ‹è¯•ä¸æ”¯æŒçš„å›½å®¶
  - æµ‹è¯•å¹´çº§/å­¦ç§‘æ ‡å‡†åŒ–

- [ ] æ‰©å±•é…ç½®åˆ°10ä¸ªå›½å®¶
  - äºšæ´²ï¼šPH, VN, TH, IN
  - ä¸­ä¸œï¼šUAE
  - è‹±è¯­ï¼šUS, GB
  - å…¶ä»–ï¼šCN

### Day 3: é›†æˆå’Œéƒ¨ç½²

- [ ] é›†æˆåˆ°ç°æœ‰æœç´¢ç³»ç»Ÿ
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆç›®æ ‡<10ç§’ï¼‰
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [ ] æ”¯æŒ10ä¸ªå›½å®¶ï¼ˆID, PH, VN, TH, IN, SA, UAE, US, GB, CNï¼‰
- [ ] å°å°¼ä¸€å¹´çº§æ•°å­¦æœç´¢èƒ½è¿”å›6ä¸ªç†æƒ³èµ„æº
- [ ] è¯„åˆ†å‡†ç¡®ç‡>85%ï¼ˆä¸äººå·¥è¯„ä¼°å¯¹æ¯”ï¼‰
- [ ] ä¸æ”¯æŒçš„å›½å®¶ä½¿ç”¨DEFAULTé…ç½®

### æ€§èƒ½éªŒæ”¶

- [ ] æœç´¢å“åº”æ—¶é—´<10ç§’
- [ ] é…ç½®åŠ è½½<0.1ç§’
- [ ] ç»“æœè¯„åˆ†<0.1ç§’

### è´¨é‡éªŒæ”¶

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡>80%
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ— å·²çŸ¥bug

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|------|------|----------|
| æ”¯æŒå›½å®¶æ•° | 10 | é…ç½®æ–‡ä»¶ |
| æœç´¢å‡†ç¡®ç‡ | >85% | äººå·¥è¯„ä¼° |
| å“åº”æ—¶é—´ | <10ç§’ | ç«¯åˆ°ç«¯è®¡æ—¶ |
| è¿è¡Œæˆæœ¬ | $0 | æ— APIè°ƒç”¨ |
| å¯é æ€§ | 100% | æ— LLMä¾èµ– |

---

## ğŸ“š æ·»åŠ æ–°å›½å®¶æŒ‡å—

### æ­¥éª¤1ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ 

```yaml
# config/country_search_config.yaml

XX:  # æ–°å›½å®¶ä»£ç 
  grade_1:
    math:
      localized_terms:
        grade: "æœ¬åœ°åŒ–å¹´çº§è¡¨è¾¾"
        subject: "æœ¬åœ°åŒ–å­¦ç§‘è¡¨è¾¾"
        curriculum: "å½“åœ°è¯¾ç¨‹æ ‡å‡†"

      queries:
        - "æœç´¢æŸ¥è¯¢1"
        - "æœç´¢æŸ¥è¯¢2"
        - "æœç´¢æŸ¥è¯¢3"

      trusted_domains:
        "trusted-domain.com": 9.5
        "another-trusted-domain.com": 8.0
```

### æ­¥éª¤2ï¼šæµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
python3 -c "
from core.rule_based_search import RuleBasedSearchEngine
engine = RuleBasedSearchEngine()
result = engine.search('XX', '1', 'math')
print(result)
"
```

### æ­¥éª¤3ï¼šéªŒè¯

- [ ] æœç´¢èƒ½è¿”å›ç»“æœ
- [ ] ç»“æœç›¸å…³ä¸”é«˜è´¨é‡
- [ ] è¯„åˆ†åˆç†

**æ—¶é—´ï¼š10åˆ†é’Ÿ**

---

## ğŸ’¡ å…³é”®æ´å¯Ÿ

### ä¸ºä»€ä¹ˆè§„åˆ™æ–¹æ¡ˆæ›´å¥½ï¼Ÿ

1. **å¯é¢„æµ‹æ€§**
   - ç›¸åŒè¾“å…¥ â†’ ç›¸åŒè¾“å‡º
   - æ— LLMå¹»è§‰
   - æ˜“äºè°ƒè¯•

2. **é›¶æˆæœ¬**
   - æ— APIè°ƒç”¨
   - æ— LLMè´¹ç”¨
   - æ°¸ä¹…å…è´¹

3. **å¿«é€Ÿå®æ–½**
   - 2-3å¤© vs 4-6å‘¨
   - æ— éœ€promptè°ƒä¼˜
   - æ— éœ€å¤„ç†LLMé”™è¯¯

4. **æ˜“äºç»´æŠ¤**
   - é…ç½®æ–‡ä»¶å³å¯
   - æ— éœ€ç¼–ç¨‹çŸ¥è¯†
   - ç‰ˆæœ¬æ§åˆ¶å‹å¥½

### YAGNIåŸåˆ™çš„åº”ç”¨

**ä¸éœ€è¦**ï¼š
- âŒ æ”¯æŒ200ä¸ªå›½å®¶ï¼ˆåªéœ€10ä¸ªï¼‰
- âŒ LLMç”Ÿæˆåˆ†æ•°ï¼ˆæ¨¡æ¿å³å¯ï¼‰
- âŒ LLMè¯„åˆ†ï¼ˆåŸŸåç™½åå•è¶³å¤Ÿï¼‰

**éœ€è¦**ï¼š
- âœ… è§£å†³å½“å‰éœ€æ±‚ï¼ˆå°å°¼ã€æ²™ç‰¹ï¼‰
- âœ… ç®€å•å¯é çš„å®ç°
- âœ… æ˜“äºæ‰©å±•ï¼ˆé…ç½®æ–‡ä»¶ï¼‰

---

## ğŸ“š å‚è€ƒèµ„æ–™

### é…ç½®æ–‡ä»¶å‚è€ƒ

- YAMLè¯­æ³•ï¼šhttps://yaml.org/spec/
- Python YAMLï¼šhttps://pyyaml.org/

### æœç´¢å¼•æ“é›†æˆ

- ç°æœ‰å®ç°ï¼š`search_engine_v2.py`
- å¤šæœç´¢å¼•æ“å¹¶è¡Œï¼šå·²å®ç°

### æµ‹è¯•æœ€ä½³å®è·µ

- pytestæ–‡æ¡£ï¼šhttps://docs.pytest.org/
- æµ‹è¯•è¦†ç›–ç‡ï¼špytest-cov

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-11
**é¢„è®¡å·¥ä½œé‡**: 2-3å¤©
**ä¼˜å…ˆçº§**: ğŸ”¥ HIGHï¼ˆç®€å•å¯é ï¼‰
